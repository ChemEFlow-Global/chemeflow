<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>chemEFlow | Next-Gen Engineering Platform</title>
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="chemEFlow">
    <meta name="application-name" content="chemEFlow">
    <meta name="msapplication-TileColor" content="#0a0e1a">
    <meta name="theme-color" content="#00f0ff">
    
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3ClinearGradient id='a' x1='0%25' y1='0%25' x2='0%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%232563eb'/%3E%3Cstop offset='100%25' style='stop-color:%231e40af'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath d='M 130 40 Q 130 20 140 10 Q 150 20 150 40 Q 150 55 140 60 Q 130 55 130 40 Z' fill='url(%23a)'/%3E%3Crect x='75' y='125' width='15' height='25' rx='2' fill='%233b82f6'/%3E%3Crect x='115' y='100' width='15' height='50' rx='2' fill='%2314b8a6'/%3E%3C/svg%3E">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Orbitron:wght@900&display=swap');
        
        :root { 
            --primary: #00f0ff; --dark: #0a0e1a; --sidebar: #141927; 
            --light: #0a0e1a; --card: rgba(20, 25, 39, 0.8); --text: #e8f0ff; --amazon: #ff9900;
        }

        .dark-theme { --light: #0a0e1a; --sidebar: #141927; --card: rgba(20, 25, 39, 0.8); --text: #e8f0ff; }
        .theme-blue { --primary: #3b82f6; }
        .theme-purple { --primary: #a855f7; }
        .theme-green { --primary: #10b981; }
        .theme-orange { --primary: #f97316; }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: var(--light); color: var(--text); margin: 0; display: flex; height: 100vh; overflow: hidden; transition: 0.3s; }

        .loading-spinner { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 50px; height: 50px; border: 5px solid rgba(0,209,178,0.3); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; z-index: 10000; display: none; }
        @keyframes spin { to { transform: translate(-50%, -50%) rotate(360deg); } }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: var(--card); color: var(--text); padding: 30px; border-radius: 20px; max-width: 600px; max-height: 80vh; overflow-y: auto; animation: slideIn 0.3s; }
        @keyframes slideIn { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-close { float: right; font-size: 28px; cursor: pointer; border: none; background: none; color: var(--text); font-weight: bold; }

        .toast { position: fixed; bottom: 30px; right: 30px; background: var(--primary); color: #000; padding: 15px 25px; border-radius: 10px; font-weight: 700; z-index: 10000; animation: slideRight 0.3s; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        @keyframes slideRight { from { transform: translateX(400px); } to { transform: translateX(0); } }

        .sidebar { width: 280px; background: var(--sidebar); color: white; display: flex; flex-direction: column; overflow-y: auto; flex-shrink: 0; border-right: 1px solid #334155; }
        
        .logo-section { padding: 30px 20px; text-align: center; border-bottom: 1px solid #1e293b; background: linear-gradient(135deg, #0b1120 0%, #1e293b 100%); }
        .logo-container { position: relative; width: 120px; height: 120px; display: flex; align-items: center; justify-content: center; margin: 0 auto; }
        .logo-ring { position: absolute; width: 100%; height: 100%; border: 3px solid transparent; border-radius: 50%; border-top-color: var(--primary); border-right-color: var(--primary); animation: rotate 3s linear infinite; }
        .logo-ring-2 { position: absolute; width: 90%; height: 90%; border: 2px solid transparent; border-radius: 50%; border-bottom-color: #64748b; border-left-color: #64748b; animation: rotate-reverse 4s linear infinite; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes rotate-reverse { from { transform: rotate(360deg); } to { transform: rotate(0deg); } }
        .logo-svg-wrapper { position: relative; width: 85px; height: 85px; z-index: 1; }
        .logo-svg-wrapper svg { width: 100%; height: 100%; filter: drop-shadow(0 4px 15px rgba(0, 209, 178, 0.3)); }
        .logo-text { font-weight: 800; font-size: 26px; color: white; letter-spacing: -1px; text-shadow: 0 2px 10px rgba(0, 209, 178, 0.5); margin-top: 15px; }
        .logo-text span { color: var(--primary); }
        .logo-subtitle { font-size: 10px; color: #94a3b8; font-weight: 600; text-transform: uppercase; letter-spacing: 2px; margin-top: 5px; }

        .search-box { padding: 15px 20px; }
        .search-box input { width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #334155; border-radius: 8px; color: white; font-size: 13px; }
        .search-box input::placeholder { color: #64748b; }
        
        .section-title { padding: 15px 25px 5px; font-size: 10px; font-weight: 800; color: #64748b; text-transform: uppercase; letter-spacing: 1px; }
        .nav-link { padding: 10px 25px; cursor: pointer; font-size: 13px; color: #94a3b8; transition: 0.2s; border-left: 3px solid transparent; display: flex; align-items: center; gap: 10px; }
        .nav-link:hover, .nav-link.active { background: #1e293b; color: white; border-left-color: var(--primary); }

        .converter-panel { margin: 10px 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 12px; border: 1px solid #1e293b; }
        .converter-panel input, .converter-panel select { width: 100%; padding: 8px; background: #0f172a; border: 1px solid #334155; color: var(--primary); margin-bottom: 8px; font-size: 12px; border-radius: 6px; }
        .converter-output { font-size: 11px; color: var(--primary); font-weight: 600; margin-top: 5px; }

        .developer-info { padding: 15px 20px; font-size: 11px; color: #94a3b8; line-height: 1.6; border-top: 1px solid #1e293b; }
        .developer-info p { margin: 5px 0; }
        .developer-info strong { color: var(--primary); }

        .sidebar-footer { margin-top: auto; padding: 15px 20px; font-size: 9px; opacity: 0.6; text-align: center; border-top: 1px solid #1e293b; }

        .main-content { flex-grow: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; align-items: center; }
        .module { display: none; width: 100%; max-width: 900px; }
        .module.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .calc-card, .card { background: var(--card); padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); border-top: 5px solid var(--primary); margin-bottom: 20px; }
        
        .welcome-hero { text-align: center; padding: 60px 40px; background: linear-gradient(135deg, #0b1120 0%, #1e293b 50%, #334155 100%); color: white; border-radius: 20px; margin-bottom: 30px; width: 100%; position: relative; overflow: hidden; }
        .welcome-hero::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(0, 209, 178, 0.1) 0%, transparent 70%); animation: pulse 4s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 0.5; } 50% { transform: scale(1.1); opacity: 0.8; } }
        
        .dashboard-logo-container { position: relative; z-index: 1; margin-bottom: 20px; }
        .dashboard-logo-ring { position: relative; width: 140px; height: 140px; margin: 0 auto; display: flex; align-items: center; justify-content: center; }
        .dashboard-logo-ring::before { content: ''; position: absolute; width: 100%; height: 100%; border: 3px solid transparent; border-radius: 50%; border-top-color: var(--primary); border-right-color: var(--primary); animation: rotate 3s linear infinite; }
        .dashboard-logo-ring::after { content: ''; position: absolute; width: 90%; height: 90%; border: 2px solid transparent; border-radius: 50%; border-bottom-color: rgba(255, 255, 255, 0.3); border-left-color: rgba(255, 255, 255, 0.3); animation: rotate-reverse 4s linear infinite; }
        .dashboard-logo-svg { width: 100px; height: 100px; filter: drop-shadow(0 8px 20px rgba(0, 209, 178, 0.4)); z-index: 1; }
        
        .welcome-hero h1 { position: relative; z-index: 1; font-size: 42px; margin: 10px 0; font-weight: 800; letter-spacing: -1px; }
        .welcome-hero h1 span { color: var(--primary); }
        .welcome-hero p { position: relative; z-index: 1; font-size: 14px; color: #94a3b8; font-weight: 600; text-transform: uppercase; letter-spacing: 2px; }
        
        .input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin: 20px 0; }
        label { font-weight: 700; font-size: 11px; color: var(--primary); display: block; margin-bottom: 5px; text-transform: uppercase; }
        input, select { width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; background: var(--light); color: var(--text); }
        
        .btn-group { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
        .btn-calc, button { flex: 2; padding: 12px; background: var(--primary); color: #000; border: none; border-radius: 8px; font-weight: 800; cursor: pointer; text-transform: uppercase; transition: 0.2s; min-width: 120px; }
        .btn-calc:hover, button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,209,178,0.3); }
        .btn-pdf { flex: 1; padding: 12px; background: var(--dark); color: white; border: none; border-radius: 8px; font-weight: 800; cursor: pointer; text-transform: uppercase; min-width: 100px; }
        .btn-pdf:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        
        .res-box, .result-box { margin-top: 20px; padding: 15px; border-radius: 10px; display: none; background: rgba(0, 209, 178, 0.05); border-left: 4px solid var(--primary); font-size: 14px; line-height: 1.6; }
        .amazon-link { display: inline-flex; align-items: center; margin-top: 15px; padding: 10px 15px; background: #232f3e; color: var(--amazon); text-decoration: none; font-weight: 700; border-radius: 8px; font-size: 11px; gap: 8px; transition: 0.2s; }
        .amazon-link:hover { background: #131921; transform: translateX(5px); }
        
        .status-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
        .status-item { padding: 15px; background: rgba(0, 209, 178, 0.1); border-radius: 10px; border-left: 3px solid var(--primary); }
        .status-item strong { display: block; margin-bottom: 5px; font-size: 12px; }

        .history-item { padding: 10px 15px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 10px; cursor: pointer; border-left: 3px solid var(--primary); transition: 0.2s; }
        .history-item:hover { background: rgba(255,255,255,0.1); transform: translateX(5px); }

        .module-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
        .module-card { background: var(--card); padding: 20px; border-radius: 15px; border-left: 4px solid var(--primary); cursor: pointer; transition: 0.2s; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .module-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .module-card h3 { margin-bottom: 10px; color: var(--primary); font-size: 16px; }
        .module-card p { font-size: 13px; line-height: 1.5; }
        .module-card small { display: block; margin-top: 8px; color: var(--primary); font-weight: 700; font-size: 11px; }

        @media (max-width: 768px) {
            body { flex-direction: column; overflow-y: auto; height: auto; }
            .sidebar { width: 100%; height: auto; border-right: none; border-bottom: 2px solid #334155; }
            .main-content { width: 100%; padding: 15px; }
            .input-grid { grid-template-columns: 1fr; }
            .welcome-hero { padding: 40px 20px; }
            .welcome-hero h1 { font-size: 32px; }
            .calc-card, .card { padding: 20px; }
            .btn-group { flex-direction: column; }
            .btn-calc, .btn-pdf { width: 100%; }
            .modal-content { margin: 20px; max-width: calc(100% - 40px); }
            .module-grid { grid-template-columns: 1fr; }
        }

        @media print {
            .sidebar, .btn-group, .amazon-link { display: none !important; }
            .main-content { padding: 0; }
            .calc-card, .card { box-shadow: none; border: 1px solid #ccc; page-break-inside: avoid; }
        }

        /* LIQUID BACKGROUND */
        .liquid-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }
        .liquid-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.4;
            animation: float 20s infinite ease-in-out;
        }
        .liquid-orb:nth-child(1) {
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, #00f0ff 0%, transparent 70%);
            top: -100px;
            left: -100px;
            animation-duration: 25s;
        }
        .liquid-orb:nth-child(2) {
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, #0080ff 0%, transparent 70%);
            top: 40%;
            right: -150px;
            animation-duration: 30s;
        }
        .liquid-orb:nth-child(3) {
            width: 350px;
            height: 350px;
            background: radial-gradient(circle, #a000ff 0%, transparent 70%);
            bottom: -100px;
            left: 30%;
            animation-duration: 35s;
        }
        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(50px, -50px) scale(1.1); }
            66% { transform: translate(-30px, 30px) scale(0.9); }
        }

        /* SPLASH SCREEN */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a0e1a;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: splash-fadeout 0.8s ease 2.5s forwards;
        }
        @keyframes splash-fadeout {
            to { opacity: 0; pointer-events: none; }
        }
        .splash-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 52px;
            font-weight: 900;
            background: linear-gradient(135deg, #00f0ff 0%, #0080ff 50%, #a000ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: text-appear 1s ease;
        }
        @keyframes text-appear {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* TOGGLE SWITCH IN TOP BAR */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(20, 25, 39, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 240, 255, 0.2);
            border-radius: 50px;
            padding: 5px;
            display: flex;
            gap: 5px;
        }
        .theme-toggle button {
            padding: 8px 16px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 700;
            transition: all 0.3s ease;
            background: transparent;
            color: #8a9fb8;
        }
        .theme-toggle button.active {
            background: var(--primary);
            color: #0a0e1a;
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.4);
        }

        /* GLASSMORPHISM */
        .sidebar {
            background: rgba(20, 25, 39, 0.8) !important;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
        .calc-card, .card {
            background: rgba(20, 25, 39, 0.8) !important;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        /* LIGHT MODE */
        body:not(.dark-theme) {
            --primary: #00d1b2;
            --light: #f8fafc;
            --dark: #f8fafc;
            --sidebar: rgba(255, 255, 255, 0.95);
            --card: rgba(255, 255, 255, 0.9);
            --text: #1e293b;
        }
        body:not(.dark-theme) .sidebar {
            background: rgba(255, 255, 255, 0.95) !important;
            color: #1e293b;
        }
        body:not(.dark-theme) .nav-link {
            color: #64748b;
        }
        body:not(.dark-theme) .nav-link:hover,
        body:not(.dark-theme) .nav-link.active {
            color: #1e293b;
        }
        body:not(.dark-theme) .liquid-orb {
            opacity: 0.15;
        }
        body:not(.dark-theme) .theme-toggle {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #e2e8f0;
        }
        body:not(.dark-theme) .logo-text,
        body:not(.dark-theme) .section-title {
            color: #1e293b !important;
        }

        /* ADMOB AD SPACES */
        .ad-banner {
            width: 100%;
            height: 50px;
            background: rgba(255, 153, 0, 0.1);
            border: 1px dashed #ff9900;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            border-radius: 8px;
            font-size: 11px;
            color: #ff9900;
        }
        .ad-interstitial-trigger {
            /* Triggers interstitial ad after calculation */
        }
    </style>
</head>
<body>

<!-- SPLASH SCREEN -->
<div id="splash-screen">
    <div class="splash-text">chemEFlow</div>
</div>

<!-- LIQUID BACKGROUND -->
<div class="liquid-background">
    <div class="liquid-orb"></div>
    <div class="liquid-orb"></div>
    <div class="liquid-orb"></div>
</div>

<!-- THEME TOGGLE -->
<div class="theme-toggle">
    <button onclick="toggleTheme('light')" id="lightBtn">‚òÄÔ∏è Light</button>
    <button onclick="toggleTheme('dark')" id="darkBtn" class="active">üåô Dark</button>
</div>


<div class="loading-spinner" id="loadingSpinner"></div>

<div class="modal" id="historyModal">
    <div class="modal-content">
        <button class="modal-close" onclick="closeModal('historyModal')">√ó</button>
        <h2>Calculation History</h2>
        <div id="historyList"></div>
        <button onclick="clearHistory()" style="width:100%; padding:10px; background:#64748b; color:white; border:none; border-radius:8px; margin-top:15px; cursor:pointer;">Clear All History</button>
    </div>
</div>

<div class="modal" id="settingsModal">
    <div class="modal-content">
        <button class="modal-close" onclick="closeModal('settingsModal')">√ó</button>
        <h2>Settings & Preferences</h2>
        <div style="margin:20px 0;">
            <h3>Color Theme</h3>
            <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
                <button onclick="changeTheme('default')" style="padding:10px 20px; background:#00d1b2; border:none; border-radius:5px; cursor:pointer; color:#000; font-weight:700;">Default</button>
                <button onclick="changeTheme('blue')" style="padding:10px 20px; background:#3b82f6; border:none; border-radius:5px; cursor:pointer; color:white; font-weight:700;">Blue</button>
                <button onclick="changeTheme('purple')" style="padding:10px 20px; background:#a855f7; border:none; border-radius:5px; cursor:pointer; color:white; font-weight:700;">Purple</button>
                <button onclick="changeTheme('green')" style="padding:10px 20px; background:#10b981; border:none; border-radius:5px; cursor:pointer; color:white; font-weight:700;">Green</button>
                <button onclick="changeTheme('orange')" style="padding:10px 20px; background:#f97316; border:none; border-radius:5px; cursor:pointer; color:white; font-weight:700;">Orange</button>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="shareModal">
    <div class="modal-content">
        <button class="modal-close" onclick="closeModal('shareModal')">√ó</button>
        <h2>Share Calculation</h2>
        <p>Copy this link to share:</p>
        <input type="text" id="shareLink" readonly style="width:100%; padding:10px; margin:10px 0; border-radius:8px; border:1px solid #e2e8f0;">
        <button onclick="copyShareLink()" style="width:100%; padding:12px; background:var(--primary); color:#000; border:none; border-radius:8px; font-weight:800; cursor:pointer;">üìã Copy Link</button>
    </div>
</div>

<div class="sidebar">
    <div class="logo-section">
        <div class="logo-container">
            <div class="logo-ring"></div>
            <div class="logo-ring-2"></div>
            <div class="logo-svg-wrapper">
                <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="dropletGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#2563eb;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#1e40af;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="arrowGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#14b8a6;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#0d9488;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="pipeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#1e40af;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="barGradient" x1="0%" y1="100%" x2="0%" y2="0%">
                            <stop offset="0%" style="stop-color:#1e40af;stop-opacity:1" />
                            <stop offset="50%" style="stop-color:#3b82f6;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#14b8a6;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <path d="M 130 40 Q 130 20 140 10 Q 150 20 150 40 Q 150 55 140 60 Q 130 55 130 40 Z" fill="url(#dropletGradient)" stroke="none"/>
                    <g>
                        <rect x="50" y="85" width="55" height="20" rx="3" fill="url(#pipeGradient)"/>
                        <circle cx="95" cy="95" r="12" fill="#1e40af" stroke="#ffffff" stroke-width="2"/>
                        <circle cx="95" cy="95" r="6" fill="#ffffff"/>
                        <rect x="45" y="80" width="8" height="30" rx="2" fill="#1e3a8a"/>
                    </g>
                    <g>
                        <rect x="75" y="125" width="15" height="25" rx="2" fill="url(#barGradient)" opacity="0.9"/>
                        <rect x="95" y="115" width="15" height="35" rx="2" fill="url(#barGradient)" opacity="0.95"/>
                        <rect x="115" y="100" width="15" height="50" rx="2" fill="url(#barGradient)"/>
                        <rect x="135" y="80" width="15" height="70" rx="2" fill="url(#barGradient)"/>
                    </g>
                    <path d="M 105 95 Q 120 85 135 75 L 145 88" fill="none" stroke="url(#arrowGradient)" stroke-width="8" stroke-linecap="round"/>
                    <path d="M 152 65 L 145 88 L 130 78 Z" fill="url(#arrowGradient)"/>
                </svg>
            </div>
        </div>
        <div class="logo-text">Chem<span>E</span>Flow</div>
        <div class="logo-subtitle">All-In-One Engineering Platform v6.0</div>
    </div>

    <div class="search-box">
        <input type="text" placeholder="üîç Search modules (Ctrl+K)" id="searchInput" onkeyup="searchModules()">
    </div>
    
    <div class="section-title">Main Navigation</div>
    <div class="nav-link active" onclick="switchTab('welcome')">üè† Dashboard</div>
    <div class="nav-link" onclick="openModal('historyModal'); loadHistory()">üìä History</div>
    <div class="nav-link" onclick="openModal('settingsModal')">‚öôÔ∏è Settings</div>
    
    <div class="section-title">Engineering Branches</div>
    <div class="nav-link" onclick="showBranchModules('chemical')">üß™ Chemical Engineering</div>
    <div class="nav-link" onclick="showBranchModules('mechanical')">‚öôÔ∏è Mechanical Engineering</div>
    <div class="nav-link" onclick="showBranchModules('civil')">üèóÔ∏è Civil Engineering</div>
    <div class="nav-link" onclick="showBranchModules('electrical')">‚ö° Electrical Engineering</div>
    <div class="nav-link" onclick="showBranchModules('industrial')">üè≠ Industrial Engineering</div>

    <div class="section-title">Quick Converter</div>
    <div class="converter-panel">
        <label style="color: var(--primary); font-size: 10px; margin-bottom: 8px; display: block;">Smart Unit Conversion</label>
        <input type="number" id="conv_in" placeholder="Enter Value" oninput="quickConvert()">
        <select id="conv_type">
            <option value="pressure">Pressure (Bar ‚Üí PSI)</option>
            <option value="power">Power (kW ‚Üí HP)</option>
            <option value="force">Force (kN ‚Üí lbf)</option>
            <option value="current">Current (A ‚Üí mA)</option>
            <option value="temp">Temperature (¬∞C ‚Üí ¬∞F)</option>
        </select>
        <div id="conv_out" class="converter-output">Result will show here...</div>
    </div>

    <div class="section-title">Developer Info</div>
    <div class="developer-info">
        <p><strong>Platform:</strong> ChemEFlow Ultimate</p>
        <p><strong>Version:</strong> v6.0.0-PRO</p>
        <p><strong>Modules:</strong> 100+ Active</p>
        <p><strong>Build:</strong> Production</p>
    </div>
    
    <div style="padding: 20px;">
        <button style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--primary); background: none; color: var(--primary); cursor: pointer; font-weight: 700; margin-bottom:10px;" onclick="document.body.classList.toggle('dark-theme')">üåó Toggle Dark Mode</button>
        <button style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--primary); background: none; color: var(--primary); cursor: pointer; font-weight: 700;" onclick="window.print()">üñ®Ô∏è Print Page</button>
    </div>

    <div class="sidebar-footer">
        ChemEFlow Ultimate v6.0.0-PRO<br>
        Status: All Systems Operational<br>
        <span id="clock"></span>
    </div>
</div>

<div class="main-content" id="mainContent">
    <div id="welcome" class="module active">
        <div class="welcome-hero">
            <div class="dashboard-logo-container">
                <div class="dashboard-logo-ring">
                    <svg class="dashboard-logo-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="dashDropletGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#2563eb;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#1e40af;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="dashArrowGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#14b8a6;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#0d9488;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="dashPipeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#1e40af;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="dashBarGradient" x1="0%" y1="100%" x2="0%" y2="0%">
                                <stop offset="0%" style="stop-color:#1e40af;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#3b82f6;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#14b8a6;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <path d="M 130 40 Q 130 20 140 10 Q 150 20 150 40 Q 150 55 140 60 Q 130 55 130 40 Z" fill="url(#dashDropletGradient)" stroke="none"/>
                        <g>
                            <rect x="50" y="85" width="55" height="20" rx="3" fill="url(#dashPipeGradient)"/>
                            <circle cx="95" cy="95" r="12" fill="#1e40af" stroke="#ffffff" stroke-width="2"/>
                            <circle cx="95" cy="95" r="6" fill="#ffffff"/>
                            <rect x="45" y="80" width="8" height="30" rx="2" fill="#1e3a8a"/>
                        </g>
                        <g>
                            <rect x="75" y="125" width="15" height="25" rx="2" fill="url(#dashBarGradient)" opacity="0.9"/>
                            <rect x="95" y="115" width="15" height="35" rx="2" fill="url(#dashBarGradient)" opacity="0.95"/>
                            <rect x="115" y="100" width="15" height="50" rx="2" fill="url(#dashBarGradient)"/>
                            <rect x="135" y="80" width="15" height="70" rx="2" fill="url(#dashBarGradient)"/>
                        </g>
                        <path d="M 105 95 Q 120 85 135 75 L 145 88" fill="none" stroke="url(#dashArrowGradient)" stroke-width="8" stroke-linecap="round"/>
                        <path d="M 152 65 L 145 88 L 130 78 Z" fill="url(#dashArrowGradient)"/>
                    </svg>
                </div>
            </div>
            
            <h1>Chem<span>E</span>Flow</h1>
            <p>Ultimate All-In-One Engineering Platform</p>
            <div style="margin-top: 30px; display: flex; gap: 15px; justify-content: center; position: relative; z-index: 1; flex-wrap:wrap;">
                <button style="padding: 12px 30px; background: var(--primary); color: #000; border: none; border-radius: 8px; font-weight: 800; cursor: pointer; text-transform: uppercase;" onclick="showBranchModules('chemical')">GET STARTED</button>
                <button style="padding: 12px 30px; background: rgba(255,255,255,0.1); color: white; border: 1px solid var(--primary); border-radius: 8px; font-weight: 800; cursor: pointer; text-transform: uppercase;" onclick="viewStats()">VIEW STATS</button>
            </div>
        </div>
        
        <div class="calc-card">
            <h2>üéì Engineering Disciplines</h2>
            <div class="module-grid">
                <div class="module-card" onclick="showBranchModules('chemical')">
                    <h3>üß™ Chemical Engineering</h3>
                    <p>10 Modules: Thermodynamics, Reactor Design, Mass Transfer, Unit Operations</p>
                </div>
                <div class="module-card" onclick="showBranchModules('mechanical')">
                    <h3>‚öôÔ∏è Mechanical Engineering</h3>
                    <p>20 Modules: Mechanics, Thermodynamics, Machine Design, Manufacturing</p>
                </div>
                <div class="module-card" onclick="showBranchModules('civil')">
                    <h3>üèóÔ∏è Civil Engineering</h3>
                    <p>20 Modules: Structures, Geotechnical, Hydraulics, Transportation</p>
                </div>
                <div class="module-card" onclick="showBranchModules('electrical')">
                    <h3>‚ö° Electrical Engineering</h3>
                    <p>25 Modules: Circuits, Power Systems, Electronics, Control Systems</p>
                </div>
                <div class="module-card" onclick="showBranchModules('industrial')">
                    <h3>üè≠ Industrial Engineering</h3>
                    <p>15 Modules: Operations Research, Quality Control, Production Planning</p>
                </div>
                <div class="module-card" onclick="window.print()">
                    <h3>üìä Export & Reports</h3>
                    <p>PDF, Excel, Share Links - Professional reporting tools</p>
                </div>
            </div>
        </div>
        
        <div class="calc-card">
            <h3>System Status</h3>
            <div class="status-grid">
                <div class="status-item">
                    <strong>TOTAL MODULES</strong>
                    90+ Active Calculators
                </div>
                <div class="status-item">
                    <strong>VERSION</strong>
                    v6.0.0-PRO Ultimate
                </div>
                <div class="status-item">
                    <strong>STATUS</strong>
                    <span style="color: var(--primary);">ALL SYSTEMS GO</span>
                </div>
            </div>
        </div>
    </div>

    <div id="branchModulesContainer"></div>
</div>

<script>
// PART 1: Core Functions & Storage
const storage = {
    save: (key, data) => localStorage.setItem(key, JSON.stringify(data)),
    load: (key) => JSON.parse(localStorage.getItem(key) || 'null'),
    remove: (key) => localStorage.removeItem(key)
};

let charts = {};

function updateClock() {
    document.getElementById('clock').textContent = new Date().toLocaleTimeString();
}
setInterval(updateClock, 1000);
updateClock();

function saveToHistory(module, inputs, result) {
    const history = storage.load('history') || [];
    history.unshift({
        module,
        inputs,
        result,
        timestamp: new Date().toISOString(),
        id: Date.now()
    });
    storage.save('history', history.slice(0, 50));
    showToast('Calculation saved to history!');
}

function loadHistory() {
    const history = storage.load('history') || [];
    const list = document.getElementById('historyList');
    list.innerHTML = history.length ? history.map(h => 
        `<div class="history-item">
            <strong>${h.module}</strong><br>
            <small>${new Date(h.timestamp).toLocaleString()}</small><br>
            <small style="color:var(--primary)">${h.result}</small>
        </div>`
    ).join('') : '<p style="text-align:center; color:#94a3b8;">No history yet</p>';
}

function clearHistory() {
    if(confirm('Clear all calculation history?')) {
        storage.remove('history');
        showToast('History cleared!');
        closeModal('historyModal');
    }
}

function changeTheme(theme) {
    const body = document.body;
    body.className = body.className.replace(/theme-\w+/g, '').replace(/dark-theme/g, '');
    if (theme !== 'default') body.classList.add(`theme-${theme}`);
    storage.save('theme', theme);
    showToast(`Theme changed to ${theme}!`);
}

function openModal(id) {
    document.getElementById(id).classList.add('active');
}

function closeModal(id) {
    document.getElementById(id).classList.remove('active');
}

function showToast(msg) {
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = msg;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
}

function switchTab(id) {
    document.querySelectorAll('.module').forEach(m => m.classList.remove('active'));
    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
    const targetModule = document.getElementById(id);
    if(targetModule) {
        targetModule.classList.add('active');
    }
    if(event && event.target) event.target.classList.add('active');
}

function searchModules() {
    const query = document.getElementById('searchInput').value.toLowerCase();
    document.querySelectorAll('.nav-link').forEach(link => {
        link.style.display = link.textContent.toLowerCase().includes(query) ? 'flex' : 'none';
    });
    document.querySelectorAll('.module-card').forEach(card => {
        card.style.display = card.textContent.toLowerCase().includes(query) ? 'block' : 'none';
    });
}

function quickConvert() {
    const val = parseFloat(document.getElementById('conv_in').value) || 0;
    const type = document.getElementById('conv_type').value;
    let res = "";
    
    switch(type) {
        case 'pressure': res = `${(val * 14.5038).toFixed(2)} PSI`; break;
        case 'power': res = `${(val * 1.341).toFixed(2)} HP`; break;
        case 'force': res = `${(val * 224.8).toFixed(1)} lbf`; break;
        case 'current': res = `${(val * 1000).toFixed(0)} mA`; break;
        case 'temp': res = `${(val * 9/5 + 32).toFixed(1)} ¬∞F`; break;
    }
    
    document.getElementById('conv_out').innerText = res || 'Result will show here...';
}

function viewStats() {
    const totalCalcs = (storage.load('history') || []).length;
    alert(`üìä ChemEFlow Statistics\n\nTotal Calculations: ${totalCalcs}\nModules Available: 90+\nVersion: v6.0.0-PRO\nStatus: All Systems Operational`);
}

// PART 2: Module Definitions
const engineeringModules = {
    chemical: [
        {id: 'mat_balance', name: 'Material Balance', desc: 'Mass conservation in mixing', formula: 'm‚ÇÉ = m‚ÇÅ + m‚ÇÇ'},
        {id: 'antoine', name: 'Antoine Equation', desc: 'Vapor pressure calculation', formula: 'log P = A - B/(T+C)'},
        {id: 'cstr', name: 'CSTR Design', desc: 'Reactor sizing', formula: 'V = F‚ÇÄX/(k(1-X))'},
        {id: 'heat_exchanger', name: 'Heat Exchanger LMTD', desc: 'Temperature difference', formula: 'LMTD = (ŒîT‚ÇÅ-ŒîT‚ÇÇ)/ln(ŒîT‚ÇÅ/ŒîT‚ÇÇ)'},
        {id: 'reynolds', name: 'Reynolds Number', desc: 'Flow regime', formula: 'Re = œÅVD/Œº'},
        {id: 'distillation', name: 'Distillation VLE', desc: 'Vapor-liquid equilibrium', formula: 'y = Œ±x/(1+(Œ±-1)x)'},
        {id: 'pump_power', name: 'Pump Power', desc: 'Required power', formula: 'P = œÅgQH/Œ∑'},
        {id: 'absorption', name: 'Absorption Tower', desc: 'Gas absorption', formula: 'N = ln[(y‚ÇÅ-mx‚ÇÇ)/(y‚ÇÇ-mx‚ÇÇ)]'},
        {id: 'crystallization', name: 'Crystallization', desc: 'Crystal yield', formula: 'Y = (C‚ÇÅ-C‚ÇÇ)/C‚ÇÅ√ó100'},
        {id: 'filtration', name: 'Filtration Rate', desc: 'Constant pressure', formula: 'V¬≤ + 2VV‚ÇÄ = K(t+t‚ÇÄ)'}
    ],
    mechanical: [
        {id: 'stress_strain', name: 'Stress-Strain', desc: 'Material deformation', formula: 'œÉ = EŒµ'},
        {id: 'bending_moment', name: 'Bending Moment', desc: 'Beam analysis', formula: 'M = œÉI/y'},
        {id: 'deflection', name: 'Beam Deflection', desc: 'Cantilever beam', formula: 'Œ¥ = PL¬≥/(3EI)'},
        {id: 'torsion', name: 'Torsional Stress', desc: 'Shaft torsion', formula: 'œÑ = Tr/J'},
        {id: 'critical_speed', name: 'Critical Speed', desc: 'Shaft critical speed', formula: 'Nc = 946.4‚àö(g/Œ¥)'},
        {id: 'gear_ratio', name: 'Gear Ratio', desc: 'Speed transmission', formula: 'VR = N‚ÇÅ/N‚ÇÇ'},
        {id: 'brake_power', name: 'Brake Power', desc: 'Engine power', formula: 'BP = 2œÄNT/60'},
        {id: 'thermal_stress', name: 'Thermal Stress', desc: 'Temperature stress', formula: 'œÉ = EŒ±ŒîT'},
        {id: 'spring_stiffness', name: 'Spring Stiffness', desc: 'Helical spring', formula: 'k = Gd‚Å¥/(8D¬≥n)'},
        {id: 'flywheel', name: 'Flywheel Energy', desc: 'Energy storage', formula: 'E = ¬ΩIœâ¬≤'},
        {id: 'carnot', name: 'Carnot Efficiency', desc: 'Maximum efficiency', formula: 'Œ∑ = 1 - T‚ÇÇ/T‚ÇÅ'},
        {id: 'rankine', name: 'Rankine Cycle', desc: 'Steam cycle', formula: 'Œ∑ = (h‚ÇÅ-h‚ÇÇ)/(h‚ÇÅ-h‚ÇÉ)'},
        {id: 'otto_cycle', name: 'Otto Cycle', desc: 'SI engine', formula: 'Œ∑ = 1 - 1/r^(Œ≥-1)'},
        {id: 'diesel_cycle', name: 'Diesel Cycle', desc: 'CI engine', formula: 'Œ∑ = 1 - [1/r^(Œ≥-1)][(Œ≤^Œ≥-1)/Œ≥(Œ≤-1)]'},
        {id: 'compressor_work', name: 'Compressor Work', desc: 'Compression work', formula: 'W = [Œ≥/(Œ≥-1)]P‚ÇÅV‚ÇÅ[(P‚ÇÇ/P‚ÇÅ)^((Œ≥-1)/Œ≥)-1]'},
        {id: 'turbine_work', name: 'Turbine Work', desc: 'Expansion work', formula: 'W = ·πÅcp(T‚ÇÅ-T‚ÇÇ)'},
        {id: 'refrigeration', name: 'COP Refrigeration', desc: 'Coefficient of performance', formula: 'COP = Q‚ÇÇ/W'},
        {id: 'bearing_life', name: 'Bearing Life', desc: 'L10 bearing life', formula: 'L‚ÇÅ‚ÇÄ = (C/P)¬≥ √ó 10‚Å∂'},
        {id: 'belt_tension', name: 'Belt Drive', desc: 'Belt tension ratio', formula: 'T‚ÇÅ/T‚ÇÇ = e^(ŒºŒ∏)'},
        {id: 'vibration_freq', name: 'Natural Frequency', desc: 'System frequency', formula: 'fn = (1/2œÄ)‚àö(k/m)'}
    ],
    civil: [
        {id: 'beam_reaction', name: 'Beam Reactions', desc: 'Support reactions', formula: 'Œ£F = 0, Œ£M = 0'},
        {id: 'shear_force', name: 'Shear Force', desc: 'Maximum shear', formula: 'Vmax = wL/2'},
        {id: 'moment_capacity', name: 'Moment Capacity', desc: 'Beam capacity', formula: 'M = fyZ'},
        {id: 'column_buckling', name: 'Column Buckling', desc: 'Euler buckling', formula: 'Pcr = œÄ¬≤EI/(KL)¬≤'},
        {id: 'concrete_mix', name: 'Concrete Mix Design', desc: 'Mix proportions', formula: 'W/C ratio'},
        {id: 'steel_design', name: 'Steel Beam Design', desc: 'Section modulus', formula: 'Z = M/fy'},
        {id: 'footing_design', name: 'Footing Design', desc: 'Bearing capacity', formula: 'qult = cNc + Œ≥DNq + 0.5Œ≥BNŒ≥'},
        {id: 'retaining_wall', name: 'Retaining Wall', desc: 'Lateral pressure', formula: 'Pa = ¬ΩŒ≥H¬≤Ka'},
        {id: 'slab_design', name: 'Slab Design', desc: 'Two-way slab', formula: 'M = Œ±wL¬≤'},
        {id: 'truss_analysis', name: 'Truss Analysis', desc: 'Member forces', formula: 'Method of joints'},
        {id: 'settlement', name: 'Settlement Calculation', desc: 'Consolidation', formula: 'S = (Cc/(1+e‚ÇÄ))H log(œÉ‚ÇÇ/œÉ‚ÇÅ)'},
        {id: 'slope_stability', name: 'Slope Stability', desc: 'Factor of safety', formula: 'FS = œÑf/œÑm'},
        {id: 'seepage', name: 'Seepage Flow', desc: 'Darcy law', formula: 'q = kiA'},
        {id: 'CBR', name: 'CBR Test', desc: 'Pavement strength', formula: 'CBR = (Test/Standard)√ó100'},
        {id: 'manning', name: 'Manning Equation', desc: 'Open channel', formula: 'Q = (1/n)AR^(2/3)S^(1/2)'},
        {id: 'weir_flow', name: 'Weir Flow', desc: 'Flow over weir', formula: 'Q = CLH^(3/2)'},
        {id: 'pipe_flow', name: 'Pipe Flow', desc: 'Hazen-Williams', formula: 'V = 0.85CR^(0.63)S^(0.54)'},
        {id: 'water_demand', name: 'Water Demand', desc: 'Population needs', formula: 'Q = P √ó q'},
        {id: 'BOD', name: 'BOD Calculation', desc: 'Oxygen demand', formula: 'BOD = (D‚ÇÅ-D‚ÇÇ)/P'},
        {id: 'traffic_volume', name: 'Traffic Volume', desc: 'AADT calculation', formula: 'AADT = Œ£(Volume√óFactor)/365'}
    ],
    electrical: [
        {id: 'ohms_law', name: 'Ohm\'s Law', desc: 'Voltage-current', formula: 'V = IR'},
        {id: 'power_calc', name: 'Power Calculation', desc: 'Electrical power', formula: 'P = VI'},
        {id: 'series_resistance', name: 'Series Resistance', desc: 'Total resistance', formula: 'Rtotal = R‚ÇÅ+R‚ÇÇ+R‚ÇÉ'},
        {id: 'parallel_resistance', name: 'Parallel Resistance', desc: 'Equivalent R', formula: '1/Rtotal = 1/R‚ÇÅ+1/R‚ÇÇ'},
        {id: 'capacitor_series', name: 'Capacitors in Series', desc: 'Total capacitance', formula: '1/Ctotal = 1/C‚ÇÅ+1/C‚ÇÇ'},
        {id: 'inductor_series', name: 'Inductors in Series', desc: 'Total inductance', formula: 'Ltotal = L‚ÇÅ+L‚ÇÇ+L‚ÇÉ'},
        {id: 'rc_time', name: 'RC Time Constant', desc: 'Charging time', formula: 'œÑ = RC'},
        {id: 'rl_time', name: 'RL Time Constant', desc: 'Current rise', formula: 'œÑ = L/R'},
        {id: 'resonance', name: 'Resonant Frequency', desc: 'LC resonance', formula: 'f‚ÇÄ = 1/(2œÄ‚àöLC)'},
        {id: 'impedance', name: 'AC Impedance', desc: 'Complex impedance', formula: 'Z = ‚àö(R¬≤+(XL-XC)¬≤)'},
        {id: 'power_factor', name: 'Power Factor', desc: 'Real to apparent', formula: 'PF = cos œÜ'},
        {id: 'three_phase', name: 'Three Phase Power', desc: 'Balanced 3-phase', formula: 'P = ‚àö3 VL IL cos œÜ'},
        {id: 'transformer', name: 'Transformer Ratio', desc: 'Voltage transformation', formula: 'V‚ÇÅ/V‚ÇÇ = N‚ÇÅ/N‚ÇÇ'},
        {id: 'motor_torque', name: 'Motor Torque', desc: 'DC motor torque', formula: 'T = KŒ¶Ia'},
        {id: 'motor_speed', name: 'Motor Speed', desc: 'Back EMF', formula: 'N = (V-IaRa)/(KŒ¶)'},
        {id: 'efficiency', name: 'Efficiency', desc: 'Machine efficiency', formula: 'Œ∑ = Pout/Pin√ó100%'},
        {id: 'voltage_divider', name: 'Voltage Divider', desc: 'Output voltage', formula: 'Vout = Vin√óR‚ÇÇ/(R‚ÇÅ+R‚ÇÇ)'},
        {id: 'current_divider', name: 'Current Divider', desc: 'Branch current', formula: 'I‚ÇÅ = Itotal√óR‚ÇÇ/(R‚ÇÅ+R‚ÇÇ)'},
        {id: 'wheatstone', name: 'Wheatstone Bridge', desc: 'Balance condition', formula: 'R‚ÇÅ/R‚ÇÇ = R‚ÇÉ/R‚ÇÑ'},
        {id: 'line_loss', name: 'Transmission Loss', desc: 'Power loss', formula: 'Ploss = I¬≤R'},
        {id: 'fault_current', name: 'Fault Current', desc: 'Short circuit', formula: 'If = V/Z'},
        {id: 'relay_setting', name: 'Relay Setting', desc: 'Protection', formula: 'PSM = Ifault/Ipickup'},
        {id: 'regulation', name: 'Voltage Regulation', desc: 'Voltage drop', formula: 'VR = (Vnl-Vfl)/Vfl√ó100%'},
        {id: 'skin_depth', name: 'Skin Depth', desc: 'AC conductor', formula: 'Œ¥ = ‚àö(2/(œâŒºœÉ))'},
        {id: 'antenna_gain', name: 'Antenna Gain', desc: 'Directivity gain', formula: 'G = 4œÄA/Œª¬≤'}
    ],
    industrial: [
        {id: 'eoq', name: 'Economic Order Quantity', desc: 'Optimal order', formula: 'EOQ = ‚àö(2DS/H)'},
        {id: 'reorder_point', name: 'Reorder Point', desc: 'Inventory level', formula: 'ROP = d√óL+SS'},
        {id: 'safety_stock', name: 'Safety Stock', desc: 'Buffer inventory', formula: 'SS = Z√óœÉ√ó‚àöL'},
        {id: 'abc_analysis', name: 'ABC Analysis', desc: 'Inventory classification', formula: 'Cumulative %'},
        {id: 'line_balancing', name: 'Line Balancing', desc: 'Assembly efficiency', formula: 'E = Œ£t/(n√óC)'},
        {id: 'takt_time', name: 'Takt Time', desc: 'Production rate', formula: 'Takt = Available/Demand'},
        {id: 'oee', name: 'Overall Equipment Effectiveness', desc: 'Machine efficiency', formula: 'OEE = A√óP√óQ'},
        {id: 'learning_curve', name: 'Learning Curve', desc: 'Time reduction', formula: 'Tn = T‚ÇÅ√ón^b'},
        {id: 'breakeven', name: 'Break-Even Analysis', desc: 'Profit point', formula: 'BEP = FC/(P-VC)'},
        {id: 'productivity', name: 'Productivity Index', desc: 'Output efficiency', formula: 'PI = Output/Input'},
        {id: 'cpk', name: 'Process Capability Cpk', desc: 'Quality index', formula: 'Cpk = min[(USL-Œº)/3œÉ,(Œº-LSL)/3œÉ]'},
        {id: 'six_sigma', name: 'Six Sigma DPMO', desc: 'Defects per million', formula: 'DPMO = (Defects/Opportunities)√ó10‚Å∂'},
        {id: 'mtbf', name: 'MTBF', desc: 'Mean time between failures', formula: 'MTBF = Total Time/# Failures'},
        {id: 'mttr', name: 'MTTR', desc: 'Mean time to repair', formula: 'MTTR = Total Repair/# Repairs'},
        {id: 'availability', name: 'System Availability', desc: 'Uptime percentage', formula: 'A = MTBF/(MTBF+MTTR)'}
    ]
};

// PART 3: Show Branch Modules
function showBranchModules(branch) {
    const container = document.getElementById('branchModulesContainer');
    const modules = engineeringModules[branch] || [];
    
    let branchNames = {
        chemical: 'üß™ Chemical Engineering',
        mechanical: '‚öôÔ∏è Mechanical Engineering',
        civil: 'üèóÔ∏è Civil Engineering',
        electrical: '‚ö° Electrical Engineering',
        industrial: 'üè≠ Industrial Engineering'
    };
    
    let html = `
        <div class="module active" id="branch_${branch}">
            <div class="calc-card">
                <h2>${branchNames[branch]}</h2>
                <p>Select a module to start calculating</p>
                <div class="module-grid">
    `;
    
    modules.forEach(mod => {
        html += `
            <div class="module-card" onclick="openCalculator('${branch}', '${mod.id}')">
                <h3>${mod.name}</h3>
                <p>${mod.desc}</p>
                <small>${mod.formula}</small>
            </div>
        `;
    });
    
    html += `
                </div>
            </div>
        </div>
    `;
    
    document.getElementById('welcome').classList.remove('active');
    container.innerHTML = html;
    showToast(`Switched to ${branchNames[branch]}`);
}

// PART 4: Open Calculator
function openCalculator(branch, calcId) {
    const container = document.getElementById('branchModulesContainer');
    const calc = engineeringModules[branch].find(m => m.id === calcId);
    
    if(!calc) {
        showToast('Calculator not found!');
        return;
    }
    
    let html = `
        <div class="module active" id="calc_${calcId}">
            <div class="calc-card">
                <button onclick="showBranchModules('${branch}')" style="margin-bottom: 20px; padding: 8px 16px; background: var(--dark); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 700;">‚Üê Back to ${branch.charAt(0).toUpperCase() + branch.slice(1)} Engineering</button>
                <h2>${calc.name}</h2>
                <p>${calc.desc}</p>
                <p style="color: var(--primary); font-weight: 700; margin: 10px 0;">Formula: ${calc.formula}</p>
                
                <div id="calc_inputs_${calcId}">
                    ${getCalculatorInputs(calcId)}
                </div>
                
                <div class="btn-group">
                    <button class="btn-calc" onclick="runCalculation('${calcId}')">Calculate</button>
                    <button class="btn-pdf" onclick="exportCalcPDF('${calc.name}', 'result_${calcId}')">PDF</button>
                    <button class="btn-pdf" onclick="exportCalcExcel('${calc.name}')">Excel</button>
                    <button class="btn-pdf" onclick="shareCalc('${calc.name}')">Share</button>
                </div>
                
                <div id="result_${calcId}" class="res-box"></div>
            </div>
        </div>
    `;
    
    container.innerHTML = html;
}
// PART 5: Get Calculator Inputs - ALL CALCULATORS
function getCalculatorInputs(calcId) {
    const inputs = {
        // ============ CHEMICAL ENGINEERING ============
        mat_balance: `
            <div class="input-grid">
                <div><label>Stream 1 Flow (kg/h)</label><input type="number" id="inp_1" value="100"></div>
                <div><label>Stream 1 Conc (%)</label><input type="number" id="inp_2" value="10"></div>
                <div><label>Stream 2 Flow (kg/h)</label><input type="number" id="inp_3" value="150"></div>
                <div><label>Stream 2 Conc (%)</label><input type="number" id="inp_4" value="50"></div>
            </div>`,
        antoine: `
            <div class="input-grid">
                <div><label>Constant A</label><input type="number" id="inp_1" value="8.07"></div>
                <div><label>Constant B</label><input type="number" id="inp_2" value="1730"></div>
                <div><label>Constant C</label><input type="number" id="inp_3" value="233"></div>
                <div><label>Temperature (¬∞C)</label><input type="number" id="inp_4" value="100"></div>
            </div>`,
        cstr: `
            <div class="input-grid">
                <div><label>Rate Constant k (s‚Åª¬π)</label><input type="number" id="inp_1" value="0.2"></div>
                <div><label>Conversion X (0-1)</label><input type="number" id="inp_2" value="0.8" step="0.01"></div>
                <div><label>Feed Flow F‚ÇÄ (L/s)</label><input type="number" id="inp_3" value="50"></div>
            </div>`,
        heat_exchanger: `
            <div class="input-grid">
                <div><label>Hot Inlet T (¬∞C)</label><input type="number" id="inp_1" value="120"></div>
                <div><label>Hot Outlet T (¬∞C)</label><input type="number" id="inp_2" value="80"></div>
                <div><label>Cold Inlet T (¬∞C)</label><input type="number" id="inp_3" value="30"></div>
                <div><label>Cold Outlet T (¬∞C)</label><input type="number" id="inp_4" value="60"></div>
            </div>`,
        reynolds: `
            <div class="input-grid">
                <div><label>Density œÅ (kg/m¬≥)</label><input type="number" id="inp_1" value="1000"></div>
                <div><label>Velocity V (m/s)</label><input type="number" id="inp_2" value="2"></div>
                <div><label>Diameter D (m)</label><input type="number" id="inp_3" value="0.1"></div>
                <div><label>Viscosity Œº (Pa¬∑s)</label><input type="number" id="inp_4" value="0.001" step="0.0001"></div>
            </div>`,
        distillation: `
            <div class="input-grid">
                <div><label>Relative Volatility Œ±</label><input type="number" id="inp_1" value="2.5"></div>
                <div><label>Liquid Mole Fraction x</label><input type="number" id="inp_2" value="0.4" step="0.01"></div>
            </div>`,
        pump_power: `
            <div class="input-grid">
                <div><label>Density œÅ (kg/m¬≥)</label><input type="number" id="inp_1" value="1000"></div>
                <div><label>Flow Rate Q (m¬≥/s)</label><input type="number" id="inp_2" value="0.05"></div>
                <div><label>Head H (m)</label><input type="number" id="inp_3" value="20"></div>
                <div><label>Efficiency Œ∑ (%)</label><input type="number" id="inp_4" value="75"></div>
            </div>`,
        absorption: `
            <div class="input-grid">
                <div><label>Inlet Gas Conc y‚ÇÅ</label><input type="number" id="inp_1" value="0.05" step="0.001"></div>
                <div><label>Outlet Gas Conc y‚ÇÇ</label><input type="number" id="inp_2" value="0.005" step="0.001"></div>
                <div><label>Liquid Conc x‚ÇÇ</label><input type="number" id="inp_3" value="0.001" step="0.0001"></div>
                <div><label>Equilibrium Slope m</label><input type="number" id="inp_4" value="1.5"></div>
            </div>`,
        crystallization: `
            <div class="input-grid">
                <div><label>Initial Conc C‚ÇÅ (g/L)</label><input type="number" id="inp_1" value="200"></div>
                <div><label>Final Conc C‚ÇÇ (g/L)</label><input type="number" id="inp_2" value="50"></div>
                <div><label>Solution Volume (L)</label><input type="number" id="inp_3" value="100"></div>
            </div>`,
        filtration: `
            <div class="input-grid">
                <div><label>Filtration Constant K (m‚Å∂)</label><input type="number" id="inp_1" value="0.001" step="0.0001"></div>
                <div><label>Time t (s)</label><input type="number" id="inp_2" value="600"></div>
                <div><label>Initial Volume V‚ÇÄ (m¬≥)</label><input type="number" id="inp_3" value="0.1"></div>
            </div>`,
            
        // ============ MECHANICAL ENGINEERING ============
        stress_strain: `
            <div class="input-grid">
                <div><label>Young's Modulus E (GPa)</label><input type="number" id="inp_1" value="200"></div>
                <div><label>Strain Œµ</label><input type="number" id="inp_2" value="0.002" step="0.0001"></div>
            </div>`,
        bending_moment: `
            <div class="input-grid">
                <div><label>Stress œÉ (MPa)</label><input type="number" id="inp_1" value="150"></div>
                <div><label>Moment of Inertia I (m‚Å¥)</label><input type="number" id="inp_2" value="0.0001" step="0.00001"></div>
                <div><label>Distance y (m)</label><input type="number" id="inp_3" value="0.1"></div>
            </div>`,
        deflection: `
            <div class="input-grid">
                <div><label>Load P (N)</label><input type="number" id="inp_1" value="1000"></div>
                <div><label>Length L (m)</label><input type="number" id="inp_2" value="2"></div>
                <div><label>Young's Modulus E (GPa)</label><input type="number" id="inp_3" value="200"></div>
                <div><label>Moment of Inertia I (m‚Å¥)</label><input type="number" id="inp_4" value="0.0001" step="0.00001"></div>
            </div>`,
        torsion: `
            <div class="input-grid">
                <div><label>Torque T (N¬∑m)</label><input type="number" id="inp_1" value="500"></div>
                <div><label>Radius r (m)</label><input type="number" id="inp_2" value="0.05"></div>
                <div><label>Polar Moment J (m‚Å¥)</label><input type="number" id="inp_3" value="0.0001" step="0.00001"></div>
            </div>`,
        critical_speed: `
            <div class="input-grid">
                <div><label>Static Deflection Œ¥ (mm)</label><input type="number" id="inp_1" value="5"></div>
                <div><label>Gravity g (m/s¬≤)</label><input type="number" id="inp_2" value="9.81"></div>
            </div>`,
        gear_ratio: `
            <div class="input-grid">
                <div><label>Driver Teeth N‚ÇÅ</label><input type="number" id="inp_1" value="20"></div>
                <div><label>Driven Teeth N‚ÇÇ</label><input type="number" id="inp_2" value="60"></div>
            </div>`,
        brake_power: `
            <div class="input-grid">
                <div><label>Speed N (RPM)</label><input type="number" id="inp_1" value="1500"></div>
                <div><label>Torque T (N¬∑m)</label><input type="number" id="inp_2" value="100"></div>
            </div>`,
        thermal_stress: `
            <div class="input-grid">
                <div><label>Young's Modulus E (GPa)</label><input type="number" id="inp_1" value="200"></div>
                <div><label>Coefficient Œ± (10‚Åª‚Å∂/¬∞C)</label><input type="number" id="inp_2" value="12"></div>
                <div><label>Temp Change ŒîT (¬∞C)</label><input type="number" id="inp_3" value="50"></div>
            </div>`,
        spring_stiffness: `
            <div class="input-grid">
                <div><label>Shear Modulus G (GPa)</label><input type="number" id="inp_1" value="80"></div>
                <div><label>Wire Diameter d (mm)</label><input type="number" id="inp_2" value="5"></div>
                <div><label>Mean Coil Diameter D (mm)</label><input type="number" id="inp_3" value="50"></div>
                <div><label>Number of Coils n</label><input type="number" id="inp_4" value="10"></div>
            </div>`,
        flywheel: `
            <div class="input-grid">
                <div><label>Moment of Inertia I (kg¬∑m¬≤)</label><input type="number" id="inp_1" value="5"></div>
                <div><label>Angular Velocity œâ (rad/s)</label><input type="number" id="inp_2" value="100"></div>
            </div>`,
        carnot: `
            <div class="input-grid">
                <div><label>Hot Reservoir T‚ÇÅ (K)</label><input type="number" id="inp_1" value="600"></div>
                <div><label>Cold Reservoir T‚ÇÇ (K)</label><input type="number" id="inp_2" value="300"></div>
            </div>`,
        rankine: `
            <div class="input-grid">
                <div><label>Enthalpy H‚ÇÅ (kJ/kg)</label><input type="number" id="inp_1" value="3000"></div>
                <div><label>Enthalpy H‚ÇÇ (kJ/kg)</label><input type="number" id="inp_2" value="2200"></div>
            </div>`,
        otto_cycle: `
            <div class="input-grid">
                <div><label>Compression Ratio r</label><input type="number" id="inp_1" value="8"></div>
                <div><label>Specific Heat Ratio Œ≥</label><input type="number" id="inp_2" value="1.4" step="0.1"></div>
            </div>`,
        diesel_cycle: `
            <div class="input-grid">
                <div><label>Compression Ratio r</label><input type="number" id="inp_1" value="18"></div>
                <div><label>Cut-off Ratio Œ≤</label><input type="number" id="inp_2" value="2"></div>
                <div><label>Specific Heat Ratio Œ≥</label><input type="number" id="inp_3" value="1.4" step="0.1"></div>
            </div>`,
        compressor_work: `
            <div class="input-grid">
                <div><label>Inlet Pressure P‚ÇÅ (bar)</label><input type="number" id="inp_1" value="1"></div>
                <div><label>Outlet Pressure P‚ÇÇ (bar)</label><input type="number" id="inp_2" value="5"></div>
                <div><label>Volume V‚ÇÅ (m¬≥)</label><input type="number" id="inp_3" value="0.1"></div>
                <div><label>Specific Heat Ratio Œ≥</label><input type="number" id="inp_4" value="1.4" step="0.1"></div>
            </div>`,
        turbine_work: `
            <div class="input-grid">
                <div><label>Mass Flow ·πÅ (kg/s)</label><input type="number" id="inp_1" value="10"></div>
                <div><label>Specific Heat cp (kJ/kg¬∑K)</label><input type="number" id="inp_2" value="1.005"></div>
                <div><label>Inlet Temp T‚ÇÅ (K)</label><input type="number" id="inp_3" value="1200"></div>
                <div><label>Outlet Temp T‚ÇÇ (K)</label><input type="number" id="inp_4" value="600"></div>
            </div>`,
        refrigeration: `
            <div class="input-grid">
                <div><label>Heat Extracted Q‚ÇÇ (kJ)</label><input type="number" id="inp_1" value="1000"></div>
                <div><label>Work Input W (kJ)</label><input type="number" id="inp_2" value="250"></div>
            </div>`,
        bearing_life: `
            <div class="input-grid">
                <div><label>Basic Load Rating C (kN)</label><input type="number" id="inp_1" value="50"></div>
                <div><label>Equivalent Load P (kN)</label><input type="number" id="inp_2" value="10"></div>
            </div>`,
        belt_tension: `
            <div class="input-grid">
                <div><label>Coefficient of Friction Œº</label><input type="number" id="inp_1" value="0.3" step="0.01"></div>
                <div><label>Angle of Contact Œ∏ (rad)</label><input type="number" id="inp_2" value="3.14"></div>
            </div>`,
        vibration_freq: `
            <div class="input-grid">
                <div><label>Stiffness k (N/m)</label><input type="number" id="inp_1" value="10000"></div>
                <div><label>Mass m (kg)</label><input type="number" id="inp_2" value="10"></div>
            </div>`,
            
        // ============ CIVIL ENGINEERING ============
        beam_reaction: `
            <div class="input-grid">
                <div><label>Point Load W (kN)</label><input type="number" id="inp_1" value="10"></div>
                <div><label>Distance from Left a (m)</label><input type="number" id="inp_2" value="2"></div>
                <div><label>Span Length L (m)</label><input type="number" id="inp_3" value="6"></div>
            </div>`,
        shear_force: `
            <div class="input-grid">
                <div><label>UDL w (kN/m)</label><input type="number" id="inp_1" value="10"></div>
                <div><label>Span Length L (m)</label><input type="number" id="inp_2" value="6"></div>
            </div>`,
        moment_capacity: `
            <div class="input-grid">
                <div><label>Yield Strength fy (MPa)</label><input type="number" id="inp_1" value="250"></div>
                <div><label>Section Modulus Z (cm¬≥)</label><input type="number" id="inp_2" value="500"></div>
            </div>`,
        column_buckling: `
            <div class="input-grid">
                <div><label>Young's Modulus E (GPa)</label><input type="number" id="inp_1" value="200"></div>
                <div><label>Moment of Inertia I (m‚Å¥)</label><input type="number" id="inp_2" value="0.0001" step="0.00001"></div>
                <div><label>Length L (m)</label><input type="number" id="inp_3" value="4"></div>
                <div><label>Effective Length Factor K</label><input type="number" id="inp_4" value="1" step="0.1"></div>
            </div>`,
        concrete_mix: `
            <div class="input-grid">
                <div><label>Cement (kg)</label><input type="number" id="inp_1" value="350"></div>
                <div><label>Water (kg)</label><input type="number" id="inp_2" value="175"></div>
                <div><label>Fine Aggregate (kg)</label><input type="number" id="inp_3" value="700"></div>
                <div><label>Coarse Aggregate (kg)</label><input type="number" id="inp_4" value="1200"></div>
            </div>`,
        steel_design: `
            <div class="input-grid">
                <div><label>Bending Moment M (kN¬∑m)</label><input type="number" id="inp_1" value="150"></div>
                <div><label>Yield Strength fy (MPa)</label><input type="number" id="inp_2" value="250"></div>
            </div>`,
        footing_design: `
            <div class="input-grid">
                <div><label>Cohesion c (kPa)</label><input type="number" id="inp_1" value="20"></div>
                <div><label>Unit Weight Œ≥ (kN/m¬≥)</label><input type="number" id="inp_2" value="18"></div>
                <div><label>Depth D (m)</label><input type="number" id="inp_3" value="1.5"></div>
                <div><label>Width B (m)</label><input type="number" id="inp_4" value="2"></div>
            </div>`,
        retaining_wall: `
            <div class="input-grid">
                <div><label>Unit Weight Œ≥ (kN/m¬≥)</label><input type="number" id="inp_1" value="18"></div>
                <div><label>Height H (m)</label><input type="number" id="inp_2" value="5"></div>
                <div><label>Friction Angle œÜ (¬∞)</label><input type="number" id="inp_3" value="30"></div>
            </div>`,
        slab_design: `
            <div class="input-grid">
                <div><label>Load w (kN/m¬≤)</label><input type="number" id="inp_1" value="5"></div>
                <div><label>Span Length L (m)</label><input type="number" id="inp_2" value="5"></div>
                <div><label>Moment Coefficient Œ±</label><input type="number" id="inp_3" value="0.125" step="0.001"></div>
            </div>`,
        truss_analysis: `
            <div class="input-grid">
                <div><label>Applied Load P (kN)</label><input type="number" id="inp_1" value="10"></div>
                <div><label>Angle Œ∏ (degrees)</label><input type="number" id="inp_2" value="30"></div>
                <div><label>Member Length L (m)</label><input type="number" id="inp_3" value="4"></div>
            </div>`,
        settlement: `
            <div class="input-grid">
                <div><label>Compression Index Cc</label><input type="number" id="inp_1" value="0.3"></div>
                <div><label>Initial Void Ratio e‚ÇÄ</label><input type="number" id="inp_2" value="0.8"></div>
                <div><label>Layer Thickness H (m)</label><input type="number" id="inp_3" value="5"></div>
                <div><label>Stress Increase ŒîœÉ (kPa)</label><input type="number" id="inp_4" value="50"></div>
                <div><label>Initial Stress œÉ‚ÇÄ (kPa)</label><input type="number" id="inp_5" value="100"></div>
            </div>`,
        slope_stability: `
            <div class="input-grid">
                <div><label>Soil Cohesion c (kPa)</label><input type="number" id="inp_1" value="20"></div>
                <div><label>Friction Angle œÜ (¬∞)</label><input type="number" id="inp_2" value="30"></div>
                <div><label>Slope Angle Œ≤ (¬∞)</label><input type="number" id="inp_3" value="25"></div>
                <div><label>Unit Weight Œ≥ (kN/m¬≥)</label><input type="number" id="inp_4" value="18"></div>
                <div><label>Height H (m)</label><input type="number" id="inp_5" value="10"></div>
            </div>`,
        seepage: `
            <div class="input-grid">
                <div><label>Permeability k (m/s)</label><input type="number" id="inp_1" value="0.0001" step="0.00001"></div>
                <div><label>Hydraulic Gradient i</label><input type="number" id="inp_2" value="0.5"></div>
                <div><label>Area A (m¬≤)</label><input type="number" id="inp_3" value="10"></div>
            </div>`,
        CBR: `
            <div class="input-grid">
                <div><label>Test Load (kN)</label><input type="number" id="inp_1" value="7"></div>
                <div><label>Standard Load (kN)</label><input type="number" id="inp_2" value="13.2"></div>
            </div>`,
        manning: `
            <div class="input-grid">
                <div><label>Manning's n</label><input type="number" id="inp_1" value="0.015" step="0.001"></div>
                <div><label>Area A (m¬≤)</label><input type="number" id="inp_2" value="10"></div>
                <div><label>Hydraulic Radius R (m)</label><input type="number" id="inp_3" value="2"></div>
                <div><label>Slope S</label><input type="number" id="inp_4" value="0.001" step="0.0001"></div>
            </div>`,
        weir_flow: `
            <div class="input-grid">
                <div><label>Weir Coefficient C</label><input type="number" id="inp_1" value="1.84"></div>
                <div><label>Weir Length L (m)</label><input type="number" id="inp_2" value="3"></div>
                <div><label>Head H (m)</label><input type="number" id="inp_3" value="0.5"></div>
            </div>`,
        pipe_flow: `
            <div class="input-grid">
                <div><label>Hazen-Williams C</label><input type="number" id="inp_1" value="120"></div>
                <div><label>Hydraulic Radius R (m)</label><input type="number" id="inp_2" value="0.15"></div>
                <div><label>Slope S</label><input type="number" id="inp_3" value="0.005" step="0.0001"></div>
            </div>`,
        water_demand: `
            <div class="input-grid">
                <div><label>Population P</label><input type="number" id="inp_1" value="50000"></div>
                <div><label>Per Capita Demand q (L/day)</label><input type="number" id="inp_2" value="150"></div>
            </div>`,
        BOD: `
            <div class="input-grid">
                <div><label>Initial DO D‚ÇÅ (mg/L)</label><input type="number" id="inp_1" value="8"></div>
                <div><label>Final DO D‚ÇÇ (mg/L)</label><input type="number" id="inp_2" value="3"></div>
                <div><label>Dilution Factor P</label><input type="number" id="inp_3" value="0.1"></div>
            </div>`,
        traffic_volume: `
            <div class="input-grid">
                <div><label>Total Annual Volume</label><input type="number" id="inp_1" value="1000000"></div>
                <div><label>Adjustment Factor</label><input type="number" id="inp_2" value="1.2"></div>
            </div>`,
            
        // ============ ELECTRICAL ENGINEERING ============
        ohms_law: `
            <div class="input-grid">
                <div><label>Voltage V (Volts)</label><input type="number" id="inp_1" value="12"></div>
                <div><label>Resistance R (Œ©)</label><input type="number" id="inp_2" value="6"></div>
            </div>`,
        power_calc: `
            <div class="input-grid">
                <div><label>Voltage V (Volts)</label><input type="number" id="inp_1" value="230"></div>
                <div><label>Current I (Amps)</label><input type="number" id="inp_2" value="10"></div>
            </div>`,
        series_resistance: `
            <div class="input-grid">
                <div><label>R‚ÇÅ (Œ©)</label><input type="number" id="inp_1" value="10"></div>
                <div><label>R‚ÇÇ (Œ©)</label><input type="number" id="inp_2" value="20"></div>
                <div><label>R‚ÇÉ (Œ©)</label><input type="number" id="inp_3" value="30"></div>
            </div>`,
        parallel_resistance: `
            <div class="input-grid">
                <div><label>R‚ÇÅ (Œ©)</label><input type="number" id="inp_1" value="10"></div>
                <div><label>R‚ÇÇ (Œ©)</label><input type="number" id="inp_2" value="20"></div>
            </div>`,
        capacitor_series: `
            <div class="input-grid">
                <div><label>C‚ÇÅ (ŒºF)</label><input type="number" id="inp_1" value="10"></div>
                <div><label>C‚ÇÇ (ŒºF)</label><input type="number" id="inp_2" value="20"></div>
            </div>`,
        inductor_series: `
            <div class="input-grid">
                <div><label>L‚ÇÅ (mH)</label><input type="number" id="inp_1" value="10"></div>
                <div><label>L‚ÇÇ (mH)</label><input type="number" id="inp_2" value="20"></div>
                <div><label>L‚ÇÉ (mH)</label><input type="number" id="inp_3" value="30"></div>
            </div>`,
        rc_time: `
            <div class="input-grid">
                <div><label>Resistance R (Œ©)</label><input type="number" id="inp_1" value="1000"></div>
                <div><label>Capacitance C (ŒºF)</label><input type="number" id="inp_2" value="100"></div>
            </div>`,
        rl_time: `
            <div class="input-grid">
                <div><label>Inductance L (H)</label><input type="number" id="inp_1" value="0.5"></div>
                <div><label>Resistance R (Œ©)</label><input type="number" id="inp_2" value="10"></div>
            </div>`,
        resonance: `
            <div class="input-grid">
                <div><label>Inductance L (H)</label><input type="number" id="inp_1" value="0.01" step="0.001"></div>
                <div><label>Capacitance C (F)</label><input type="number" id="inp_2" value="0.0001" step="0.00001"></div>
            </div>`,
        impedance: `
            <div class="input-grid">
                <div><label>Resistance R (Œ©)</label><input type="number" id="inp_1" value="50"></div>
                <div><label>Inductive Reactance XL (Œ©)</label><input type="number" id="inp_2" value="40"></div>
                <div><label>Capacitive Reactance XC (Œ©)</label><input type="number" id="inp_3" value="20"></div>
            </div>`,
        power_factor: `
            <div class="input-grid">
                <div><label>Real Power P (W)</label><input type="number" id="inp_1" value="1000"></div>
                <div><label>Apparent Power S (VA)</label><input type="number" id="inp_2" value="1200"></div>
            </div>`,
        three_phase: `
            <div class="input-grid">
                <div><label>Line Voltage VL (V)</label><input type="number" id="inp_1" value="400"></div>
                <div><label>Line Current IL (A)</label><input type="number" id="inp_2" value="10"></div>
                <div><label>Power Factor cos œÜ</label><input type="number" id="inp_3" value="0.85" step="0.01"></div>
            </div>`,
        transformer: `
            <div class="input-grid">
                <div><label>Primary Voltage V‚ÇÅ (V)</label><input type="number" id="inp_1" value="230"></div>
                <div><label>Primary Turns N‚ÇÅ</label><input type="number" id="inp_2" value="1000"></div>
                <div><label>Secondary Turns N‚ÇÇ</label><input type="number" id="inp_3" value="100"></div>
            </div>`,
        motor_torque: `
            <div class="input-grid">
                <div><label>Constant K</label><input type="number" id="inp_1" value="0.5"></div>
                <div><label>Flux Œ¶ (Wb)</label><input type="number" id="inp_2" value="0.8"></div>
                <div><label>Armature Current Ia (A)</label><input type="number" id="inp_3" value="10"></div>
            </div>`,
        motor_speed: `
            <div class="input-grid">
                <div><label>Voltage V (V)</label><input type="number" id="inp_1" value="230"></div>
                <div><label>Armature Current Ia (A)</label><input type="number" id="inp_2" value="10"></div>
                <div><label>Armature Resistance Ra (Œ©)</label><input type="number" id="inp_3" value="0.5"></div>
                <div><label>Constant K√óŒ¶</label><input type="number" id="inp_4" value="0.4"></div>
            </div>`,
        efficiency: `
            <div class="input-grid">
                <div><label>Output Power Pout (W)</label><input type="number" id="inp_1" value="1000"></div>
                <div><label>Input Power Pin (W)</label><input type="number" id="inp_2" value="1200"></div>
            </div>`,
        voltage_divider: `
            <div class="input-grid">
                <div><label>Input Voltage Vin (V)</label><input type="number" id="inp_1" value="12"></div>
                <div><label>Resistance R‚ÇÅ (Œ©)</label><input type="number" id="inp_2" value="1000"></div>
                <div><label>Resistance R‚ÇÇ (Œ©)</label><input type="number" id="inp_3" value="2000"></div>
            </div>`,
        current_divider: `
            <div class="input-grid">
                <div><label>Total Current Itotal (A)</label><input type="number" id="inp_1" value="3"></div>
                <div><label>Resistance R‚ÇÅ (Œ©)</label><input type="number" id="inp_2" value="10"></div>
                <div><label>Resistance R‚ÇÇ (Œ©)</label><input type="number" id="inp_3" value="20"></div>
            </div>`,
        wheatstone: `
            <div class="input-grid">
                <div><label>R‚ÇÅ (Œ©)</label><input type="number" id="inp_1" value="100"></div>
                <div><label>R‚ÇÇ (Œ©)</label><input type="number" id="inp_2" value="200"></div>
                <div><label>R‚ÇÉ (Œ©)</label><input type="number" id="inp_3" value="150"></div>
            </div>`,
        line_loss: `
            <div class="input-grid">
                <div><label>Current I (A)</label><input type="number" id="inp_1" value="50"></div>
                <div><label>Line Resistance R (Œ©)</label><input type="number" id="inp_2" value="2"></div>
            </div>`,
        fault_current: `
            <div class="input-grid">
                <div><label>Voltage V (V)</label><input type="number" id="inp_1" value="11000"></div>
                <div><label>Impedance Z (Œ©)</label><input type="number" id="inp_2" value="5"></div>
            </div>`,
        relay_setting: `
            <div class="input-grid">
                <div><label>Fault Current If (A)</label><input type="number" id="inp_1" value="1000"></div>
                <div><label>Pickup Current Ip (A)</label><input type="number" id="inp_2" value="100"></div>
            </div>`,
        regulation: `
            <div class="input-grid">
                <div><label>No-Load Voltage Vnl (V)</label><input type="number" id="inp_1" value="240"></div>
                <div><label>Full-Load Voltage Vfl (V)</label><input type="number" id="inp_2" value="230"></div>
            </div>`,
        skin_depth: `
            <div class="input-grid">
                <div><label>Frequency œâ (rad/s)</label><input type="number" id="inp_1" value="314"></div>
                <div><label>Permeability Œº (H/m)</label><input type="number" id="inp_2" value="0.00000126" step="0.0000000001"></div>
                <div><label>Conductivity œÉ (S/m)</label><input type="number" id="inp_3" value="58000000"></div>
            </div>`,
        antenna_gain: `
            <div class="input-grid">
                <div><label>Effective Area A (m¬≤)</label><input type="number" id="inp_1" value="1"></div>
                <div><label>Wavelength Œª (m)</label><input type="number" id="inp_2" value="0.1"></div>
            </div>`,
            
        // ============ INDUSTRIAL ENGINEERING ============
        eoq: `
            <div class="input-grid">
                <div><label>Annual Demand D (units)</label><input type="number" id="inp_1" value="10000"></div>
                <div><label>Ordering Cost S ($)</label><input type="number" id="inp_2" value="50"></div>
                <div><label>Holding Cost H ($/unit/year)</label><input type="number" id="inp_3" value="5"></div>
            </div>`,
        reorder_point: `
            <div class="input-grid">
                <div><label>Daily Demand d (units)</label><input type="number" id="inp_1" value="100"></div>
                <div><label>Lead Time L (days)</label><input type="number" id="inp_2" value="7"></div>
                <div><label>Safety Stock SS (units)</label><input type="number" id="inp_3" value="200"></div>
            </div>`,
        safety_stock: `
            <div class="input-grid">
                <div><label>Z-Score (Service Level)</label><input type="number" id="inp_1" value="1.65" step="0.01"></div>
                <div><label>Std Deviation œÉ</label><input type="number" id="inp_2" value="20"></div>
                <div><label>Lead Time L (days)</label><input type="number" id="inp_3" value="7"></div>
            </div>`,
        abc_analysis: `
            <div class="input-grid">
                <div><label>Item Value ($)</label><input type="number" id="inp_1" value="5000"></div>
                <div><label>Total Inventory Value ($)</label><input type="number" id="inp_2" value="100000"></div>
            </div>`,
        line_balancing: `
            <div class="input-grid">
                <div><label>Total Task Time Œ£t (min)</label><input type="number" id="inp_1" value="120"></div>
                <div><label>Number of Workstations n</label><input type="number" id="inp_2" value="6"></div>
                <div><label>Cycle Time C (min)</label><input type="number" id="inp_3" value="25"></div>
            </div>`,
        takt_time: `
            <div class="input-grid">
                <div><label>Available Time (seconds)</label><input type="number" id="inp_1" value="28800"></div>
                <div><label>Customer Demand (units)</label><input type="number" id="inp_2" value="480"></div>
            </div>`,
        oee: `
            <div class="input-grid">
                <div><label>Availability (%)</label><input type="number" id="inp_1" value="90"></div>
                <div><label>Performance (%)</label><input type="number" id="inp_2" value="85"></div>
                <div><label>Quality (%)</label><input type="number" id="inp_3" value="95"></div>
            </div>`,
        learning_curve: `
            <div class="input-grid">
                <div><label>First Unit Time T‚ÇÅ (hrs)</label><input type="number" id="inp_1" value="100"></div>
                <div><label>Unit Number n</label><input type="number" id="inp_2" value="10"></div>
                <div><label>Learning Rate (%)</label><input type="number" id="inp_3" value="80"></div>
            </div>`,
        breakeven: `
            <div class="input-grid">
                <div><label>Fixed Cost FC ($)</label><input type="number" id="inp_1" value="50000"></div>
                <div><label>Selling Price P ($/unit)</label><input type="number" id="inp_2" value="100"></div>
                <div><label>Variable Cost VC ($/unit)</label><input type="number" id="inp_3" value="60"></div>
            </div>`,
        productivity: `
            <div class="input-grid">
                <div><label>Output (units)</label><input type="number" id="inp_1" value="1000"></div>
                <div><label>Input (labor hours)</label><input type="number" id="inp_2" value="200"></div>
            </div>`,
        cpk: `
            <div class="input-grid">
                <div><label>Upper Spec Limit USL</label><input type="number" id="inp_1" value="100"></div>
                <div><label>Lower Spec Limit LSL</label><input type="number" id="inp_2" value="80"></div>
                <div><label>Process Mean Œº</label><input type="number" id="inp_3" value="90"></div>
                <div><label>Std Deviation œÉ</label><input type="number" id="inp_4" value="2"></div>
            </div>`,
        six_sigma: `
            <div class="input-grid">
                <div><label>Number of Defects</label><input type="number" id="inp_1" value="50"></div>
                <div><label>Total Opportunities</label><input type="number" id="inp_2" value="10000"></div>
            </div>`,
        mtbf: `
            <div class="input-grid">
                <div><label>Total Operating Time (hrs)</label><input type="number" id="inp_1" value="10000"></div>
                <div><label>Number of Failures</label><input type="number" id="inp_2" value="10"></div>
            </div>`,
        mttr: `
            <div class="input-grid">
                <div><label>Total Repair Time (hrs)</label><input type="number" id="inp_1" value="50"></div>
                <div><label>Number of Repairs</label><input type="number" id="inp_2" value="10"></div>
            </div>`,
        availability: `
            <div class="input-grid">
                <div><label>MTBF (hours)</label><input type="number" id="inp_1" value="1000"></div>
                <div><label>MTTR (hours)</label><input type="number" id="inp_2" value="5"></div>
            </div>`
    };
    
    return inputs[calcId] || '<p style="color: #ff6b6b;">Calculator inputs not configured yet. Contact support.</p>';
}
// PART 6: Run Calculation - ALL CALCULATORS WITH AMAZON LINKS
function runCalculation(calcId) {
    const inp1 = parseFloat(document.getElementById('inp_1')?.value) || 0;
    const inp2 = parseFloat(document.getElementById('inp_2')?.value) || 0;
    const inp3 = parseFloat(document.getElementById('inp_3')?.value) || 0;
    const inp4 = parseFloat(document.getElementById('inp_4')?.value) || 0;
    const inp5 = parseFloat(document.getElementById('inp_5')?.value) || 0;
    let result = '';
    
    // ============ CHEMICAL ENGINEERING ============
    if(calcId === 'mat_balance') {
        const m3 = inp1 + inp3;
        const x3 = ((inp1 * inp2/100) + (inp3 * inp4/100)) / m3;
        result = `<strong>Total Flow:</strong> ${m3.toFixed(2)} kg/h<br><strong>Exit Concentration:</strong> ${(x3*100).toFixed(2)}%`;
        saveToHistory('Material Balance', {m1:inp1, x1:inp2, m2:inp3, x2:inp4}, `Flow: ${m3.toFixed(2)} kg/h`);
        result += `<br><a href="https://www.amazon.com/s?k=Industrial+Inline+Mixer" target="_blank" class="amazon-link">üõí Industrial Mixers</a>`;
    }
    else if(calcId === 'antoine') {
        const p = Math.pow(10, inp1 - (inp2 / (inp4 + inp3)));
        result = `<strong>Vapor Pressure:</strong> ${p.toFixed(2)} mmHg<br><strong>Temperature:</strong> ${inp4}¬∞C`;
        saveToHistory('Antoine Equation', {A:inp1, B:inp2, C:inp3, T:inp4}, `P = ${p.toFixed(2)} mmHg`);
        result += `<br><a href="https://www.amazon.com/s?k=Digital+Pressure+Gauge" target="_blank" class="amazon-link">üõí Pressure Gauges</a>`;
    }
    else if(calcId === 'cstr') {
        const vol = (inp3 * inp2) / (inp1 * (1 - inp2));
        result = `<strong>CSTR Volume:</strong> ${vol.toFixed(2)} L<br><strong>Conversion:</strong> ${(inp2*100).toFixed(1)}%`;
        saveToHistory('CSTR Design', {k:inp1, X:inp2, F0:inp3}, `V = ${vol.toFixed(2)} L`);
        result += `<br><a href="https://www.amazon.com/s?k=Stainless+Steel+Reactor+Vessel" target="_blank" class="amazon-link">üõí Reactor Vessels</a>`;
    }
    else if(calcId === 'heat_exchanger') {
        const dt1 = inp1 - inp4;
        const dt2 = inp2 - inp3;
        const lmtd = (dt1 - dt2) / Math.log(dt1 / dt2);
        result = `<strong>LMTD:</strong> ${lmtd.toFixed(2)}¬∞C<br><strong>ŒîT‚ÇÅ:</strong> ${dt1.toFixed(2)}¬∞C<br><strong>ŒîT‚ÇÇ:</strong> ${dt2.toFixed(2)}¬∞C`;
        saveToHistory('Heat Exchanger LMTD', {Thi:inp1, Tho:inp2, Tci:inp3, Tco:inp4}, `LMTD = ${lmtd.toFixed(2)}¬∞C`);
        result += `<br><a href="https://www.amazon.com/s?k=Shell+Tube+Heat+Exchanger" target="_blank" class="amazon-link">üõí Heat Exchangers</a>`;
    }
    else if(calcId === 'reynolds') {
        const re = (inp1 * inp2 * inp3) / inp4;
        const flow = re < 2300 ? 'Laminar' : re < 4000 ? 'Transitional' : 'Turbulent';
        result = `<strong>Reynolds Number:</strong> ${re.toFixed(0)}<br><strong>Flow Regime:</strong> ${flow}`;
        saveToHistory('Reynolds Number', {rho:inp1, V:inp2, D:inp3, mu:inp4}, `Re = ${re.toFixed(0)}`);
        result += `<br><a href="https://www.amazon.com/s?k=Ultrasonic+Flowmeter" target="_blank" class="amazon-link">üõí Flow Meters</a>`;
    }
    else if(calcId === 'distillation') {
        const y = (inp1 * inp2) / (1 + (inp1 - 1) * inp2);
        result = `<strong>Vapor Mole Fraction y:</strong> ${y.toFixed(4)}<br><strong>Liquid Mole Fraction x:</strong> ${inp2.toFixed(4)}`;
        saveToHistory('Distillation VLE', {alpha:inp1, x:inp2}, `y = ${y.toFixed(4)}`);
        result += `<br><a href="https://www.amazon.com/s?k=Distillation+Column+Packing" target="_blank" class="amazon-link">üõí Column Packing</a>`;
    }
    else if(calcId === 'pump_power') {
        const g = 9.81;
        const power = (inp1 * g * inp2 * inp3) / ((inp4/100) * 1000);
        result = `<strong>Pump Power:</strong> ${power.toFixed(2)} kW<br><strong>Hydraulic Power:</strong> ${(inp1 * g * inp2 * inp3 / 1000).toFixed(2)} kW<br><strong>Efficiency:</strong> ${inp4}%`;
        saveToHistory('Pump Power', {rho:inp1, Q:inp2, H:inp3, eta:inp4}, `P = ${power.toFixed(2)} kW`);
        result += `<br><a href="https://www.amazon.com/s?k=Chemical+Pump+Centrifugal" target="_blank" class="amazon-link">üõí Process Pumps</a>`;
    }
    else if(calcId === 'absorption') {
        const N = Math.log((inp1 - inp4*inp3)/(inp2 - inp4*inp3)) / Math.log(inp4);
        result = `<strong>Number of Stages N:</strong> ${N.toFixed(2)}<br><strong>Height per Stage:</strong> ${(10/N).toFixed(2)} m (approx)`;
        saveToHistory('Absorption Tower', {y1:inp1, y2:inp2, x2:inp3, m:inp4}, `N = ${N.toFixed(2)} stages`);
        result += `<br><a href="https://www.amazon.com/s?k=Industrial+Absorption+Column" target="_blank" class="amazon-link">üõí Absorption Towers</a>`;
    }
    else if(calcId === 'crystallization') {
        const crystalYield = ((inp1 - inp2) / inp1) * 100;
        const crystalMass = (inp1 - inp2) * inp3 / 1000;
        result = `<strong>Crystal Yield:</strong> ${crystalYield.toFixed(2)}%<br><strong>Crystal Mass:</strong> ${crystalMass.toFixed(2)} kg`;
        saveToHistory('Crystallization', {C1:inp1, C2:inp2, V:inp3}, `Yield = ${crystalYield.toFixed(2)}%`);
        result += `<br><a href="https://www.amazon.com/s?k=Crystallization+Equipment" target="_blank" class="amazon-link">üõí Crystallization Equipment</a>`;
    }
    else if(calcId === 'filtration') {
        const V = Math.sqrt(inp1 * inp2 + 2 * inp1 * inp2 * inp3) - inp3;
        const rate = V / inp2;
        result = `<strong>Filtrate Volume:</strong> ${V.toFixed(4)} m¬≥<br><strong>Filtration Rate:</strong> ${(rate*1000).toFixed(2)} L/s`;
        saveToHistory('Filtration Rate', {K:inp1, t:inp2, V0:inp3}, `V = ${V.toFixed(4)} m¬≥`);
        result += `<br><a href="https://www.amazon.com/s?k=Industrial+Filter+Press" target="_blank" class="amazon-link">üõí Filter Presses</a>`;
    }
    
    // ============ MECHANICAL ENGINEERING ============
    else if(calcId === 'stress_strain') {
        const stress = inp1 * 1000 * inp2;
        result = `<strong>Stress œÉ:</strong> ${stress.toFixed(2)} MPa<br><strong>Strain Œµ:</strong> ${inp2.toFixed(4)}`;
        saveToHistory('Stress-Strain', {E:inp1, epsilon:inp2}, `œÉ = ${stress.toFixed(2)} MPa`);
        result += `<br><a href="https://www.amazon.com/s?k=Universal+Testing+Machine" target="_blank" class="amazon-link">üõí Testing Equipment</a>`;
    }
    else if(calcId === 'bending_moment') {
        const M = (inp1 * 1e6 * inp2) / inp3;
        result = `<strong>Bending Moment M:</strong> ${(M/1000).toFixed(2)} kN¬∑m<br><strong>Section Stress:</strong> ${inp1} MPa`;
        saveToHistory('Bending Moment', {sigma:inp1, I:inp2, y:inp3}, `M = ${(M/1000).toFixed(2)} kN¬∑m`);
        result += `<br><a href="https://www.amazon.com/s?k=Beam+Analysis+Equipment" target="_blank" class="amazon-link">üõí Structural Analysis Tools</a>`;
    }
    else if(calcId === 'deflection') {
        const E_Pa = inp3 * 1e9;
        const deflection = (inp1 * Math.pow(inp2, 3)) / (3 * E_Pa * inp4);
        result = `<strong>Deflection Œ¥:</strong> ${(deflection*1000).toFixed(4)} mm<br><strong>Load:</strong> ${inp1} N<br><strong>Length:</strong> ${inp2} m`;
        saveToHistory('Beam Deflection', {P:inp1, L:inp2, E:inp3, I:inp4}, `Œ¥ = ${(deflection*1000).toFixed(4)} mm`);
        result += `<br><a href="https://www.amazon.com/s?k=Structural+Analysis+Tools" target="_blank" class="amazon-link">üõí Analysis Tools</a>`;
    }
    else if(calcId === 'torsion') {
        const tau = (inp1 * inp2) / inp3;
        result = `<strong>Torsional Stress œÑ:</strong> ${(tau/1e6).toFixed(2)} MPa<br><strong>Torque:</strong> ${inp1} N¬∑m`;
        saveToHistory('Torsional Stress', {T:inp1, r:inp2, J:inp3}, `œÑ = ${(tau/1e6).toFixed(2)} MPa`);
        result += `<br><a href="https://www.amazon.com/s?k=Torque+Wrench" target="_blank" class="amazon-link">üõí Torque Tools</a>`;
    }
    else if(calcId === 'critical_speed') {
        const Nc = 946.4 * Math.sqrt(inp2 / (inp1/1000));
        result = `<strong>Critical Speed:</strong> ${Nc.toFixed(0)} RPM<br><strong>Safe Operating Speed:</strong> ${(Nc*0.7).toFixed(0)} RPM (70%)`;
        saveToHistory('Critical Speed', {delta:inp1, g:inp2}, `Nc = ${Nc.toFixed(0)} RPM`);
        result += `<br><a href="https://www.amazon.com/s?k=Shaft+Vibration+Analyzer" target="_blank" class="amazon-link">üõí Vibration Analysis Equipment</a>`;
    }
    else if(calcId === 'gear_ratio') {
        const vr = inp1 / inp2;
        const speedChange = vr < 1 ? 'Increase' : 'Decrease';
        result = `<strong>Velocity Ratio:</strong> ${vr.toFixed(3)}<br><strong>Speed:</strong> ${speedChange} (${(vr < 1 ? inp2/inp1 : inp1/inp2).toFixed(2)}√ó)`;
        saveToHistory('Gear Ratio', {N1:inp1, N2:inp2}, `VR = ${vr.toFixed(3)}`);
        result += `<br><a href="https://www.amazon.com/s?k=Gear+Set" target="_blank" class="amazon-link">üõí Gears & Gear Sets</a>`;
    }
    else if(calcId === 'brake_power') {
        const BP = (2 * Math.PI * inp1 * inp2) / 60000;
        result = `<strong>Brake Power:</strong> ${BP.toFixed(2)} kW<br><strong>Horsepower:</strong> ${(BP*1.341).toFixed(2)} HP`;
        saveToHistory('Brake Power', {N:inp1, T:inp2}, `BP = ${BP.toFixed(2)} kW`);
        result += `<br><a href="https://www.amazon.com/s?k=Engine+Dynamometer" target="_blank" class="amazon-link">üõí Power Measurement Equipment</a>`;
    }
    else if(calcId === 'thermal_stress') {
        const sigma = inp1 * 1000 * (inp2 / 1e6) * inp3;
        result = `<strong>Thermal Stress œÉ:</strong> ${sigma.toFixed(2)} MPa<br><strong>Temperature Change:</strong> ${inp3}¬∞C`;
        saveToHistory('Thermal Stress', {E:inp1, alpha:inp2, deltaT:inp3}, `œÉ = ${sigma.toFixed(2)} MPa`);
        result += `<br><a href="https://www.amazon.com/s?k=Thermal+Stress+Analyzer" target="_blank" class="amazon-link">üõí Thermal Analysis Equipment</a>`;
    }
    else if(calcId === 'spring_stiffness') {
        const G_Pa = inp1 * 1e9;
        const d_m = inp2 / 1000;
        const D_m = inp3 / 1000;
        const k = (G_Pa * Math.pow(d_m, 4)) / (8 * Math.pow(D_m, 3) * inp4);
        result = `<strong>Spring Stiffness k:</strong> ${k.toFixed(0)} N/m<br><strong>Spring Rate:</strong> ${(k/1000).toFixed(2)} N/mm`;
        saveToHistory('Spring Stiffness', {G:inp1, d:inp2, D:inp3, n:inp4}, `k = ${k.toFixed(0)} N/m`);
        result += `<br><a href="https://www.amazon.com/s?k=Compression+Springs" target="_blank" class="amazon-link">üõí Industrial Springs</a>`;
    }
    else if(calcId === 'flywheel') {
        const E = 0.5 * inp1 * Math.pow(inp2, 2);
        result = `<strong>Stored Energy:</strong> ${(E/1000).toFixed(2)} kJ<br><strong>Power Capacity:</strong> ${(E/1000).toFixed(2)} kW @ 1s discharge`;
        saveToHistory('Flywheel Energy', {I:inp1, omega:inp2}, `E = ${(E/1000).toFixed(2)} kJ`);
        result += `<br><a href="https://www.amazon.com/s?k=Flywheel+Assembly" target="_blank" class="amazon-link">üõí Flywheel Components</a>`;
    }
    else if(calcId === 'carnot') {
        const eff = (1 - inp2/inp1) * 100;
        result = `<strong>Carnot Efficiency:</strong> ${eff.toFixed(2)}%<br><strong>T‚ÇÅ:</strong> ${inp1} K<br><strong>T‚ÇÇ:</strong> ${inp2} K`;
        saveToHistory('Carnot Efficiency', {T1:inp1, T2:inp2}, `Œ∑ = ${eff.toFixed(2)}%`);
        result += `<br><a href="https://www.amazon.com/s?k=Thermodynamics+Textbook" target="_blank" class="amazon-link">üõí Thermodynamics Books</a>`;
    }
    else if(calcId === 'rankine') {
        const eff = ((1 - inp2/inp1) * 100);
        result = `<strong>Thermal Efficiency:</strong> ${eff.toFixed(2)}%<br><strong>Work Output:</strong> ${(inp1-inp2).toFixed(2)} kJ/kg`;
        saveToHistory('Rankine Cycle', {H1:inp1, H2:inp2}, `Œ∑ = ${eff.toFixed(2)}%`);
        result += `<br><a href="https://www.amazon.com/s?k=Steam+Turbine" target="_blank" class="amazon-link">üõí Steam Turbines</a>`;
    }
    else if(calcId === 'otto_cycle') {
        const eff = (1 - 1/Math.pow(inp1, inp2-1)) * 100;
        result = `<strong>Otto Efficiency:</strong> ${eff.toFixed(2)}%<br><strong>Compression Ratio:</strong> ${inp1}:1`;
        saveToHistory('Otto Cycle', {r:inp1, gamma:inp2}, `Œ∑ = ${eff.toFixed(2)}%`);
        result += `<br><a href="https://www.amazon.com/s?k=Engine+Components" target="_blank" class="amazon-link">üõí Engine Parts</a>`;
    }
    else if(calcId === 'diesel_cycle') {
        const term1 = 1 / Math.pow(inp1, inp3 - 1);
        const term2 = (Math.pow(inp2, inp3) - 1) / (inp3 * (inp2 - 1));
        const eff = (1 - term1 * term2) * 100;
        result = `<strong>Diesel Efficiency:</strong> ${eff.toFixed(2)}%<br><strong>Compression Ratio:</strong> ${inp1}:1<br><strong>Cut-off Ratio:</strong> ${inp2}`;
        saveToHistory('Diesel Cycle', {r:inp1, beta:inp2, gamma:inp3}, `Œ∑ = ${eff.toFixed(2)}%`);
        result += `<br><a href="https://www.amazon.com/s?k=Diesel+Engine+Components" target="_blank" class="amazon-link">üõí Diesel Engine Parts</a>`;
    }
    else if(calcId === 'compressor_work') {
        const P1_Pa = inp1 * 1e5;
        const P2_Pa = inp2 * 1e5;
        const W = (inp4 / (inp4 - 1)) * P1_Pa * inp3 * (Math.pow(P2_Pa/P1_Pa, (inp4-1)/inp4) - 1);
        result = `<strong>Compressor Work:</strong> ${(W/1000).toFixed(2)} kJ<br><strong>Power Required:</strong> ${(W/1000).toFixed(2)} kW @ 1s`;
        saveToHistory('Compressor Work', {P1:inp1, P2:inp2, V1:inp3, gamma:inp4}, `W = ${(W/1000).toFixed(2)} kJ`);
        result += `<br><a href="https://www.amazon.com/s?k=Industrial+Air+Compressor" target="_blank" class="amazon-link">üõí Air Compressors</a>`;
    }
    else if(calcId === 'turbine_work') {
        const W = inp1 * inp2 * (inp3 - inp4);
        result = `<strong>Turbine Work:</strong> ${W.toFixed(2)} kW<br><strong>Heat Drop:</strong> ${(inp3-inp4).toFixed(1)} K`;
        saveToHistory('Turbine Work', {mdot:inp1, cp:inp2, T1:inp3, T2:inp4}, `W = ${W.toFixed(2)} kW`);
        result += `<br><a href="https://www.amazon.com/s?k=Steam+Turbine+Equipment" target="_blank" class="amazon-link">üõí Turbine Equipment</a>`;
    }
    else if(calcId === 'refrigeration') {
        const COP = inp1 / inp2;
        result = `<strong>COP:</strong> ${COP.toFixed(2)}<br><strong>Performance:</strong> ${COP >= 3 ? 'Good' : COP >= 2 ? 'Average' : 'Poor'}`;
        saveToHistory('COP Refrigeration', {Q2:inp1, W:inp2}, `COP = ${COP.toFixed(2)}`);
        result += `<br><a href="https://www.amazon.com/s?k=Refrigeration+Compressor" target="_blank" class="amazon-link">üõí Refrigeration Equipment</a>`;
    }
    else if(calcId === 'bearing_life') {
        const L10 = Math.pow(inp1/inp2, 3) * 1e6;
        const hours = L10 / (60 * inp2 * 1000);
        result = `<strong>L‚ÇÅ‚ÇÄ Life:</strong> ${(L10/1e6).toFixed(2)} million revolutions<br><strong>Estimated Hours:</strong> ${hours.toFixed(0)} hrs @ 1000 RPM`;
        saveToHistory('Bearing Life', {C:inp1, P:inp2}, `L10 = ${(L10/1e6).toFixed(2)} M rev`);
        result += `<br><a href="https://www.amazon.com/s?k=Industrial+Bearings" target="_blank" class="amazon-link">üõí Industrial Bearings</a>`;
    }
    else if(calcId === 'belt_tension') {
        const ratio = Math.exp(inp1 * inp2);
        result = `<strong>Tension Ratio T‚ÇÅ/T‚ÇÇ:</strong> ${ratio.toFixed(3)}<br><strong>Tight Side:</strong> ${ratio.toFixed(2)}√ó Slack Side`;
        saveToHistory('Belt Drive', {mu:inp1, theta:inp2}, `T1/T2 = ${ratio.toFixed(3)}`);
        result += `<br><a href="https://www.amazon.com/s?k=V+Belt+Drive" target="_blank" class="amazon-link">üõí Belt Drive Systems</a>`;
    }
    else if(calcId === 'vibration_freq') {
        const fn = (1 / (2 * Math.PI)) * Math.sqrt(inp1 / inp2);
        result = `<strong>Natural Frequency:</strong> ${fn.toFixed(2)} Hz<br><strong>Period:</strong> ${(1/fn).toFixed(4)} s`;
        saveToHistory('Natural Frequency', {k:inp1, m:inp2}, `fn = ${fn.toFixed(2)} Hz`);
        result += `<br><a href="https://www.amazon.com/s?k=Vibration+Damper" target="_blank" class="amazon-link">üõí Vibration Control Equipment</a>`;
    }
    
    // ============ CIVIL ENGINEERING ============
    else if(calcId === 'beam_reaction') {
        const b = inp3 - inp2;
        const Ra = (inp1 * b) / inp3;
        const Rb = inp1 - Ra;
        result = `<strong>Reaction at A:</strong> ${Ra.toFixed(2)} kN<br><strong>Reaction at B:</strong> ${Rb.toFixed(2)} kN`;
        saveToHistory('Beam Reactions', {W:inp1, a:inp2, L:inp3}, `Ra = ${Ra.toFixed(2)} kN`);
        result += `<br><a href="https://www.amazon.com/s?k=Structural+Analysis+Software" target="_blank" class="amazon-link">üõí Analysis Software</a>`;
    }
    else if(calcId === 'shear_force') {
        const Vmax = (inp1 * inp2) / 2;
        result = `<strong>Maximum Shear Force:</strong> ${Vmax.toFixed(2)} kN<br><strong>Location:</strong> Supports`;
        saveToHistory('Shear Force', {w:inp1, L:inp2}, `Vmax = ${Vmax.toFixed(2)} kN`);
        result += `<br><a href="https://www.amazon.com/s?k=Structural+Analysis+Tools" target="_blank" class="amazon-link">üõí Analysis Tools</a>`;
    }
    else if(calcId === 'moment_capacity') {
        const M = (inp1 * inp2) / 1000;
        result = `<strong>Moment Capacity:</strong> ${M.toFixed(2)} kN¬∑m<br><strong>Section Modulus Required:</strong> ${inp2} cm¬≥`;
        saveToHistory('Moment Capacity', {fy:inp1, Z:inp2}, `M = ${M.toFixed(2)} kN¬∑m`);
        result += `<br><a href="https://www.amazon.com/s?k=Steel+I+Beam" target="_blank" class="amazon-link">üõí Steel Beams</a>`;
    }
    else if(calcId === 'column_buckling') {
        const E_Pa = inp1 * 1e9;
        const Pcr = (Math.PI * Math.PI * E_Pa * inp2) / Math.pow(inp4 * inp3, 2);
        result = `<strong>Critical Load:</strong> ${(Pcr/1000).toFixed(2)} kN<br><strong>Euler Buckling Load</strong>`;
        saveToHistory('Column Buckling', {E:inp1, I:inp2, L:inp3, K:inp4}, `Pcr = ${(Pcr/1000).toFixed(2)} kN`);
        result += `<br><a href="https://www.amazon.com/s?k=Steel+Column" target="_blank" class="amazon-link">üõí Steel Columns</a>`;
    }
    else if(calcId === 'concrete_mix') {
        const total = inp1 + inp2 + inp3 + inp4;
        const wc = inp2 / inp1;
        result = `<strong>Total Mix:</strong> ${total.toFixed(0)} kg/m¬≥<br><strong>W/C Ratio:</strong> ${wc.toFixed(2)}<br><strong>Mix Ratio:</strong> 1:${(inp3/inp1).toFixed(2)}:${(inp4/inp1).toFixed(2)}`;
        saveToHistory('Concrete Mix Design', {C:inp1, W:inp2, FA:inp3, CA:inp4}, `W/C = ${wc.toFixed(2)}`);
        result += `<br><a href="https://www.amazon.com/s?k=Concrete+Mixer" target="_blank" class="amazon-link">üõí Concrete Mixers</a>`;
    }
    else if(calcId === 'steel_design') {
        const Z_req = (inp1 * 1e6) / inp2;
        result = `<strong>Section Modulus Required:</strong> ${(Z_req/1e3).toFixed(2)} cm¬≥<br><strong>Suggested Section:</strong> Check steel tables`;
        saveToHistory('Steel Beam Design', {M:inp1, fy:inp2}, `Z = ${(Z_req/1e3).toFixed(2)} cm¬≥`);
        result += `<br><a href="https://www.amazon.com/s?k=Steel+Design+Manual" target="_blank" class="amazon-link">üõí Steel Design Manuals</a>`;
    }
    else if(calcId === 'footing_design') {
        const Nc = 5.14, Nq = 1, Ngamma = 0;
        const qult = inp1 * Nc + inp2 * inp3 * Nq + 0.5 * inp2 * inp4 * Ngamma;
        result = `<strong>Ultimate Bearing Capacity:</strong> ${qult.toFixed(2)} kPa<br><strong>Safe Bearing Capacity:</strong> ${(qult/3).toFixed(2)} kPa (FS=3)`;
        saveToHistory('Footing Design', {c:inp1, gamma:inp2, D:inp3, B:inp4}, `qult = ${qult.toFixed(2)} kPa`);
        result += `<br><a href="https://www.amazon.com/s?k=Foundation+Design+Book" target="_blank" class="amazon-link">üõí Foundation Engineering Books</a>`;
    }
    else if(calcId === 'retaining_wall') {
        const Ka = Math.tan(Math.pow(45 - inp3/2, 2) * Math.PI/180);
        const Pa = 0.5 * inp1 * Math.pow(inp2, 2) * Ka;
        result = `<strong>Active Earth Pressure:</strong> ${Pa.toFixed(2)} kN/m<br><strong>Coefficient Ka:</strong> ${Ka.toFixed(3)}`;
        saveToHistory('Retaining Wall', {gamma:inp1, H:inp2, phi:inp3}, `Pa = ${Pa.toFixed(2)} kN/m`);
        result += `<br><a href="https://www.amazon.com/s?k=Retaining+Wall+Design" target="_blank" class="amazon-link">üõí Design Software</a>`;
    }
    else if(calcId === 'slab_design') {
        const M = inp3 * inp1 * Math.pow(inp2, 2);
        result = `<strong>Design Moment:</strong> ${M.toFixed(2)} kN¬∑m/m<br><strong>Required Reinforcement:</strong> Calculate using M/(0.87√ófy√ód)`;
        saveToHistory('Slab Design', {w:inp1, L:inp2, alpha:inp3}, `M = ${M.toFixed(2)} kN¬∑m/m`);
        result += `<br><a href="https://www.amazon.com/s?k=Rebar+Steel" target="_blank" class="amazon-link">üõí Reinforcement Steel</a>`;
    }
    else if(calcId === 'truss_analysis') {
        const theta_rad = inp2 * Math.PI / 180;
        const F_horizontal = inp1 / Math.tan(theta_rad);
        const F_member = inp1 / Math.sin(theta_rad);
        result = `<strong>Member Force:</strong> ${F_member.toFixed(2)} kN<br><strong>Horizontal Component:</strong> ${F_horizontal.toFixed(2)} kN`;
        saveToHistory('Truss Analysis', {P:inp1, theta:inp2, L:inp3}, `F = ${F_member.toFixed(2)} kN`);
        result += `<br><a href="https://www.amazon.com/s?k=Truss+Analysis+Software" target="_blank" class="amazon-link">üõí Structural Analysis Software</a>`;
    }
    else if(calcId === 'settlement') {
        const S = (inp1 / (1 + inp2)) * inp3 * Math.log10((inp5 + inp4) / inp5);
        result = `<strong>Settlement:</strong> ${(S*1000).toFixed(2)} mm<br><strong>Consolidation Settlement</strong>`;
        saveToHistory('Settlement Calculation', {Cc:inp1, e0:inp2, H:inp3, dsigma:inp4}, `S = ${(S*1000).toFixed(2)} mm`);
        result += `<br><a href="https://www.amazon.com/s?k=Soil+Testing+Equipment" target="_blank" class="amazon-link">üõí Geotechnical Testing Equipment</a>`;
    }
    else if(calcId === 'slope_stability') {
        const beta_rad = inp3 * Math.PI / 180;
        const phi_rad = inp2 * Math.PI / 180;
        const FS = (inp1 + inp4 * inp5 * Math.cos(beta_rad) * Math.tan(phi_rad)) / (inp4 * inp5 * Math.sin(beta_rad));
        result = `<strong>Factor of Safety:</strong> ${FS.toFixed(2)}<br><strong>Slope Stability:</strong> ${FS >= 1.5 ? 'Safe' : FS >= 1.2 ? 'Marginally Safe' : 'Unsafe'}`;
        saveToHistory('Slope Stability', {c:inp1, phi:inp2, beta:inp3}, `FS = ${FS.toFixed(2)}`);
        result += `<br><a href="https://www.amazon.com/s?k=Slope+Stability+Analysis" target="_blank" class="amazon-link">üõí Geotechnical Software</a>`;
    }
    else if(calcId === 'seepage') {
        const q = inp1 * inp2 * inp3;
        result = `<strong>Seepage Flow Rate:</strong> ${(q*1000).toFixed(4)} L/s<br><strong>Daily Flow:</strong> ${(q*86400).toFixed(2)} m¬≥/day`;
        saveToHistory('Seepage Flow', {k:inp1, i:inp2, A:inp3}, `q = ${(q*1000).toFixed(4)} L/s`);
        result += `<br><a href="https://www.amazon.com/s?k=Permeameter" target="_blank" class="amazon-link">üõí Permeability Testing Equipment</a>`;
    }
    else if(calcId === 'CBR') {
        const CBR = (inp1 / inp2) * 100;
        result = `<strong>CBR Value:</strong> ${CBR.toFixed(1)}%<br><strong>Pavement Quality:</strong> ${CBR >= 10 ? 'Excellent' : CBR >= 5 ? 'Good' : CBR >= 2 ? 'Fair' : 'Poor'}`;
        saveToHistory('CBR Test', {test_load:inp1, std_load:inp2}, `CBR = ${CBR.toFixed(1)}%`);
        result += `<br><a href="https://www.amazon.com/s?k=CBR+Testing+Equipment" target="_blank" class="amazon-link">üõí CBR Test Apparatus</a>`;
    }
    else if(calcId === 'manning') {
        const Q = (1/inp1) * inp2 * Math.pow(inp3, 2/3) * Math.pow(inp4, 0.5);
        result = `<strong>Flow Rate Q:</strong> ${Q.toFixed(2)} m¬≥/s<br><strong>Velocity:</strong> ${(Q/inp2).toFixed(2)} m/s`;
        saveToHistory('Manning Equation', {n:inp1, A:inp2, R:inp3, S:inp4}, `Q = ${Q.toFixed(2)} m¬≥/s`);
        result += `<br><a href="https://www.amazon.com/s?k=Flow+Meter" target="_blank" class="amazon-link">üõí Flow Measurement Equipment</a>`;
    }
    else if(calcId === 'weir_flow') {
        const Q = inp1 * inp2 * Math.pow(inp3, 1.5);
        result = `<strong>Flow Rate Q:</strong> ${Q.toFixed(3)} m¬≥/s<br><strong>Flow:</strong> ${(Q*1000).toFixed(2)} L/s`;
        saveToHistory('Weir Flow', {C:inp1, L:inp2, H:inp3}, `Q = ${Q.toFixed(3)} m¬≥/s`);
        result += `<br><a href="https://www.amazon.com/s?k=Weir+Flow+Meter" target="_blank" class="amazon-link">üõí Flow Measurement Equipment</a>`;
    }
    else if(calcId === 'pipe_flow') {
        const V = 0.85 * inp1 * Math.pow(inp2, 0.63) * Math.pow(inp3, 0.54);
        result = `<strong>Flow Velocity:</strong> ${V.toFixed(3)} m/s<br><strong>Flow Rate:</strong> ${(V * Math.PI * Math.pow(inp2, 2)).toFixed(4)} m¬≥/s`;
        saveToHistory('Pipe Flow', {C:inp1, R:inp2, S:inp3}, `V = ${V.toFixed(3)} m/s`);
        result += `<br><a href="https://www.amazon.com/s?k=PVC+Pipe" target="_blank" class="amazon-link">üõí Piping Materials</a>`;
    }
    else if(calcId === 'water_demand') {
        const Q = inp1 * inp2;
        result = `<strong>Total Water Demand:</strong> ${(Q/1000).toFixed(0)} m¬≥/day<br><strong>Peak Demand:</strong> ${(Q*1.8/1000).toFixed(0)} m¬≥/day (1.8√ó factor)`;
        saveToHistory('Water Demand', {P:inp1, q:inp2}, `Q = ${(Q/1000).toFixed(0)} m¬≥/day`);
        result += `<br><a href="https://www.amazon.com/s?k=Water+Distribution+Equipment" target="_blank" class="amazon-link">üõí Water Supply Equipment</a>`;
    }
    else if(calcId === 'BOD') {
        const BOD = (inp1 - inp2) / inp3;
        result = `<strong>BOD:</strong> ${BOD.toFixed(1)} mg/L<br><strong>Water Quality:</strong> ${BOD < 3 ? 'Excellent' : BOD < 6 ? 'Good' : BOD < 10 ? 'Fair' : 'Poor'}`;
        saveToHistory('BOD Calculation', {D1:inp1, D2:inp2, P:inp3}, `BOD = ${BOD.toFixed(1)} mg/L`);
        result += `<br><a href="https://www.amazon.com/s?k=BOD+Meter" target="_blank" class="amazon-link">üõí Water Quality Testing Equipment</a>`;
    }
    else if(calcId === 'traffic_volume') {
        const AADT = (inp1 * inp2) / 365;
        result = `<strong>AADT:</strong> ${AADT.toFixed(0)} vehicles/day<br><strong>Peak Hour Volume:</strong> ${(AADT * 0.1).toFixed(0)} vehicles/hour (10% factor)`;
        saveToHistory('Traffic Volume', {volume:inp1, factor:inp2}, `AADT = ${AADT.toFixed(0)} veh/day`);
        result += `<br><a href="https://www.amazon.com/s?k=Traffic+Counter" target="_blank" class="amazon-link">üõí Traffic Counting Equipment</a>`;
    }
    
    // ============ ELECTRICAL ENGINEERING ============
    else if(calcId === 'ohms_law') {
        const I = inp1 / inp2;
        result = `<strong>Current I:</strong> ${I.toFixed(2)} A<br><strong>Voltage:</strong> ${inp1} V<br><strong>Resistance:</strong> ${inp2} Œ©`;
        saveToHistory('Ohm\'s Law', {V:inp1, R:inp2}, `I = ${I.toFixed(2)} A`);
        result += `<br><a href="https://www.amazon.com/s?k=Multimeter" target="_blank" class="amazon-link">üõí Multimeters</a>`;
    }
    else if(calcId === 'power_calc') {
        const P = inp1 * inp2;
        result = `<strong>Power P:</strong> ${P.toFixed(2)} W<br><strong>Energy (1hr):</strong> ${(P/1000).toFixed(3)} kWh`;
        saveToHistory('Power Calculation', {V:inp1, I:inp2}, `P = ${P.toFixed(2)} W`);
        result += `<br><a href="https://www.amazon.com/s?k=Power+Analyzer" target="_blank" class="amazon-link">üõí Power Quality Analyzers</a>`;
    }
    else if(calcId === 'series_resistance') {
        const Rtotal = inp1 + inp2 + inp3;
        result = `<strong>Total Resistance:</strong> ${Rtotal.toFixed(2)} Œ©`;
        saveToHistory('Series Resistance', {R1:inp1, R2:inp2, R3:inp3}, `Rtotal = ${Rtotal.toFixed(2)} Œ©`);
        result += `<br><a href="https://www.amazon.com/s?k=Resistor+Kit" target="_blank" class="amazon-link">üõí Resistor Sets</a>`;
    }
    else if(calcId === 'parallel_resistance') {
        const Rtotal = 1 / (1/inp1 + 1/inp2);
        result = `<strong>Equivalent Resistance:</strong> ${Rtotal.toFixed(2)} Œ©`;
        saveToHistory('Parallel Resistance', {R1:inp1, R2:inp2}, `Rtotal = ${Rtotal.toFixed(2)} Œ©`);
        result += `<br><a href="https://www.amazon.com/s?k=Resistor+Kit" target="_blank" class="amazon-link">üõí Resistor Sets</a>`;
    }
    else if(calcId === 'capacitor_series') {
        const Ctotal = 1 / (1/inp1 + 1/inp2);
        result = `<strong>Total Capacitance:</strong> ${Ctotal.toFixed(2)} ŒºF<br><strong>Equivalent:</strong> Less than smallest capacitor`;
        saveToHistory('Capacitors in Series', {C1:inp1, C2:inp2}, `Ctotal = ${Ctotal.toFixed(2)} ŒºF`);
        result += `<br><a href="https://www.amazon.com/s?k=Capacitor+Kit" target="_blank" class="amazon-link">üõí Capacitor Sets</a>`;
    }
    else if(calcId === 'inductor_series') {
        const Ltotal = inp1 + inp2 + inp3;
        result = `<strong>Total Inductance:</strong> ${Ltotal.toFixed(1)} mH<br><strong>Sum of all inductors</strong>`;
        saveToHistory('Inductors in Series', {L1:inp1, L2:inp2, L3:inp3}, `Ltotal = ${Ltotal.toFixed(1)} mH`);
        result += `<br><a href="https://www.amazon.com/s?k=Inductor+Kit" target="_blank" class="amazon-link">üõí Inductor Sets</a>`;
    }
    else if(calcId === 'rc_time') {
        const tau = (inp1 * inp2) / 1000000;
        result = `<strong>Time Constant œÑ:</strong> ${tau.toFixed(4)} s<br><strong>5œÑ (99% charge):</strong> ${(tau*5).toFixed(3)} s`;
        saveToHistory('RC Time Constant', {R:inp1, C:inp2}, `œÑ = ${tau.toFixed(4)} s`);
        result += `<br><a href="https://www.amazon.com/s?k=Capacitor+Meter" target="_blank" class="amazon-link">üõí Capacitance Measurement</a>`;
    }
    else if(calcId === 'rl_time') {
        const tau = inp1 / inp2;
        result = `<strong>Time Constant œÑ:</strong> ${tau.toFixed(4)} s<br><strong>5œÑ (99% current):</strong> ${(tau*5).toFixed(3)} s`;
        saveToHistory('RL Time Constant', {L:inp1, R:inp2}, `œÑ = ${tau.toFixed(4)} s`);
        result += `<br><a href="https://www.amazon.com/s?k=Inductance+Meter" target="_blank" class="amazon-link">üõí Inductance Measurement</a>`;
    }
    else if(calcId === 'resonance') {
        const f0 = 1 / (2 * Math.PI * Math.sqrt(inp1 * inp2));
        result = `<strong>Resonant Frequency:</strong> ${f0.toFixed(2)} Hz<br><strong>Angular Frequency:</strong> ${(2*Math.PI*f0).toFixed(2)} rad/s`;
        saveToHistory('Resonant Frequency', {L:inp1, C:inp2}, `f‚ÇÄ = ${f0.toFixed(2)} Hz`);
        result += `<br><a href="https://www.amazon.com/s?k=Frequency+Counter" target="_blank" class="amazon-link">üõí Frequency Counter</a>`;
    }
    else if(calcId === 'impedance') {
        const Z = Math.sqrt(Math.pow(inp1, 2) + Math.pow(inp2 - inp3, 2));
        const angle = Math.atan((inp2 - inp3) / inp1) * 180 / Math.PI;
        result = `<strong>Impedance Z:</strong> ${Z.toFixed(2)} Œ©<br><strong>Phase Angle:</strong> ${angle.toFixed(1)}¬∞`;
        saveToHistory('AC Impedance', {R:inp1, XL:inp2, XC:inp3}, `Z = ${Z.toFixed(2)} Œ©`);
        result += `<br><a href="https://www.amazon.com/s?k=Impedance+Analyzer" target="_blank" class="amazon-link">üõí Impedance Measurement Tools</a>`;
    }
    else if(calcId === 'power_factor') {
        const pf = inp1 / inp2;
        const angle = Math.acos(pf) * 180 / Math.PI;
        result = `<strong>Power Factor:</strong> ${pf.toFixed(3)}<br><strong>Phase Angle:</strong> ${angle.toFixed(1)}¬∞`;
        saveToHistory('Power Factor', {P:inp1, S:inp2}, `PF = ${pf.toFixed(3)}`);
        result += `<br><a href="https://www.amazon.com/s?k=Power+Factor+Meter" target="_blank" class="amazon-link">üõí Power Factor Meters</a>`;
    }
    else if(calcId === 'three_phase') {
        const P = Math.sqrt(3) * inp1 * inp2 * inp3;
        result = `<strong>Real Power:</strong> ${(P/1000).toFixed(2)} kW<br><strong>Apparent Power:</strong> ${(P/(inp3*1000)).toFixed(2)} kVA`;
        saveToHistory('Three Phase Power', {VL:inp1, IL:inp2, pf:inp3}, `P = ${(P/1000).toFixed(2)} kW`);
        result += `<br><a href="https://www.amazon.com/s?k=Three+Phase+Meter" target="_blank" class="amazon-link">üõí 3-Phase Power Meters</a>`;
    }
    else if(calcId === 'transformer') {
        const V2 = inp1 * inp3 / inp2;
        result = `<strong>Secondary Voltage:</strong> ${V2.toFixed(2)} V<br><strong>Turns Ratio:</strong> ${(inp2/inp3).toFixed(2)}:1`;
        saveToHistory('Transformer Ratio', {V1:inp1, N1:inp2, N2:inp3}, `V‚ÇÇ = ${V2.toFixed(2)} V`);
        result += `<br><a href="https://www.amazon.com/s?k=Transformer" target="_blank" class="amazon-link">üõí Transformers</a>`;
    }
    else if(calcId === 'motor_torque') {
        const T = inp1 * inp2 * inp3;
        result = `<strong>Motor Torque:</strong> ${T.toFixed(2)} N¬∑m<br><strong>Power @ 1500 RPM:</strong> ${(2*Math.PI*1500*T/60000).toFixed(2)} kW`;
        saveToHistory('Motor Torque', {K:inp1, Phi:inp2, Ia:inp3}, `T = ${T.toFixed(2)} N¬∑m`);
        result += `<br><a href="https://www.amazon.com/s?k=DC+Motor" target="_blank" class="amazon-link">üõí DC Motors</a>`;
    }
    else if(calcId === 'motor_speed') {
        const N = (inp1 - inp2 * inp3) / inp4;
        result = `<strong>Motor Speed:</strong> ${N.toFixed(0)} RPM<br><strong>Back EMF:</strong> ${(inp1 - inp2*inp3).toFixed(2)} V`;
        saveToHistory('Motor Speed', {V:inp1, Ia:inp2, Ra:inp3, KPhi:inp4}, `N = ${N.toFixed(0)} RPM`);
        result += `<br><a href="https://www.amazon.com/s?k=Motor+Speed+Controller" target="_blank" class="amazon-link">üõí Speed Controllers</a>`;
    }
    else if(calcId === 'efficiency') {
        const eff = (inp1 / inp2) * 100;
        const loss = inp2 - inp1;
        result = `<strong>Efficiency Œ∑:</strong> ${eff.toFixed(2)}%<br><strong>Power Loss:</strong> ${loss.toFixed(2)} W`;
        saveToHistory('Efficiency', {Pout:inp1, Pin:inp2}, `Œ∑ = ${eff.toFixed(2)}%`);
        result += `<br><a href="https://www.amazon.com/s?k=Power+Quality+Analyzer" target="_blank" class="amazon-link">üõí Power Analyzers</a>`;
    }
    else if(calcId === 'voltage_divider') {
        const Vout = inp1 * inp3 / (inp2 + inp3);
        result = `<strong>Output Voltage:</strong> ${Vout.toFixed(2)} V<br><strong>Voltage Ratio:</strong> ${(Vout/inp1*100).toFixed(1)}%`;
        saveToHistory('Voltage Divider', {Vin:inp1, R1:inp2, R2:inp3}, `Vout = ${Vout.toFixed(2)} V`);
        result += `<br><a href="https://www.amazon.com/s?k=Resistor+Kit" target="_blank" class="amazon-link">üõí Resistor Sets</a>`;
    }
    else if(calcId === 'current_divider') {
        const I1 = inp1 * inp3 / (inp2 + inp3);
        result = `<strong>Branch Current I‚ÇÅ:</strong> ${I1.toFixed(3)} A<br><strong>Branch Current I‚ÇÇ:</strong> ${(inp1-I1).toFixed(3)} A`;
        saveToHistory('Current Divider', {Itotal:inp1, R1:inp2, R2:inp3}, `I1 = ${I1.toFixed(3)} A`);
        result += `<br><a href="https://www.amazon.com/s?k=Current+Meter" target="_blank" class="amazon-link">üõí Current Measurement Tools</a>`;
    }
    else if(calcId === 'wheatstone') {
        const R4 = (inp2 * inp3) / inp1;
        const balanced = Math.abs(inp1 * R4 - inp2 * inp3) < 0.01 ? 'Balanced' : 'Unbalanced';
        result = `<strong>Unknown Resistance R‚ÇÑ:</strong> ${R4.toFixed(2)} Œ©<br><strong>Bridge Status:</strong> ${balanced}`;
        saveToHistory('Wheatstone Bridge', {R1:inp1, R2:inp2, R3:inp3}, `R4 = ${R4.toFixed(2)} Œ©`);
        result += `<br><a href="https://www.amazon.com/s?k=Wheatstone+Bridge" target="_blank" class="amazon-link">üõí Bridge Measurement Equipment</a>`;
    }
    else if(calcId === 'line_loss') {
        const Ploss = Math.pow(inp1, 2) * inp2;
        result = `<strong>Power Loss:</strong> ${(Ploss/1000).toFixed(2)} kW<br><strong>Energy Loss (24h):</strong> ${(Ploss*24/1000).toFixed(1)} kWh`;
        saveToHistory('Transmission Loss', {I:inp1, R:inp2}, `Ploss = ${(Ploss/1000).toFixed(2)} kW`);
        result += `<br><a href="https://www.amazon.com/s?k=Power+Cable" target="_blank" class="amazon-link">üõí Power Transmission Cable</a>`;
    }
    else if(calcId === 'fault_current') {
        const If = inp1 / inp2;
        result = `<strong>Fault Current:</strong> ${If.toFixed(0)} A<br><strong>Fault Level:</strong> ${(inp1*If/1000000).toFixed(2)} MVA`;
        saveToHistory('Fault Current', {V:inp1, Z:inp2}, `If = ${If.toFixed(0)} A`);
        result += `<br><a href="https://www.amazon.com/s?k=Circuit+Breaker" target="_blank" class="amazon-link">üõí Protection Equipment</a>`;
    }
    else if(calcId === 'relay_setting') {
        const PSM = inp1 / inp2;
        result = `<strong>Plug Setting Multiplier:</strong> ${PSM.toFixed(2)}<br><strong>Coordination:</strong> ${PSM >= 2 ? 'Good' : 'Review Required'}`;
        saveToHistory('Relay Setting', {If:inp1, Ip:inp2}, `PSM = ${PSM.toFixed(2)}`);
        result += `<br><a href="https://www.amazon.com/s?k=Protective+Relay" target="_blank" class="amazon-link">üõí Protection Relays</a>`;
    }
    else if(calcId === 'regulation') {
        const VR = ((inp1 - inp2) / inp2) * 100;
        result = `<strong>Voltage Regulation:</strong> ${VR.toFixed(2)}%<br><strong>Performance:</strong> ${VR < 5 ? 'Excellent' : VR < 10 ? 'Good' : 'Poor'}`;
        saveToHistory('Voltage Regulation', {Vnl:inp1, Vfl:inp2}, `VR = ${VR.toFixed(2)}%`);
        result += `<br><a href="https://www.amazon.com/s?k=Voltage+Regulator" target="_blank" class="amazon-link">üõí Voltage Regulators</a>`;
    }
    else if(calcId === 'skin_depth') {
        const delta = Math.sqrt(2 / (inp1 * inp2 * inp3));
        result = `<strong>Skin Depth Œ¥:</strong> ${(delta*1000).toFixed(4)} mm<br><strong>Effective Conductor Depth</strong>`;
        saveToHistory('Skin Depth', {omega:inp1, mu:inp2, sigma:inp3}, `Œ¥ = ${(delta*1000).toFixed(4)} mm`);
        result += `<br><a href="https://www.amazon.com/s?k=Litz+Wire" target="_blank" class="amazon-link">üõí High Frequency Conductors</a>`;
    }
    else if(calcId === 'antenna_gain') {
        const G = (4 * Math.PI * inp1) / Math.pow(inp2, 2);
        const G_dB = 10 * Math.log10(G);
        result = `<strong>Antenna Gain:</strong> ${G.toFixed(2)} (${G_dB.toFixed(1)} dB)<br><strong>Directivity Gain</strong>`;
        saveToHistory('Antenna Gain', {A:inp1, lambda:inp2}, `G = ${G_dB.toFixed(1)} dB`);
        result += `<br><a href="https://www.amazon.com/s?k=Antenna+Analyzer" target="_blank" class="amazon-link">üõí Antenna Testing Equipment</a>`;
    }
    
    // ============ INDUSTRIAL ENGINEERING ============
    else if(calcId === 'eoq') {
        const eoq = Math.sqrt((2 * inp1 * inp2) / inp3);
        const orders = inp1 / eoq;
        result = `<strong>Economic Order Quantity:</strong> ${eoq.toFixed(0)} units<br><strong>Number of Orders/Year:</strong> ${orders.toFixed(1)}`;
        saveToHistory('EOQ', {D:inp1, S:inp2, H:inp3}, `EOQ = ${eoq.toFixed(0)} units`);
        result += `<br><a href="https://www.amazon.com/s?k=Inventory+Management+Software" target="_blank" class="amazon-link">üõí Inventory Management Tools</a>`;
    }
    else if(calcId === 'reorder_point') {
        const rop = inp1 * inp2 + inp3;
        result = `<strong>Reorder Point:</strong> ${rop.toFixed(0)} units<br><strong>Lead Time Demand:</strong> ${(inp1*inp2).toFixed(0)} units`;
        saveToHistory('Reorder Point', {d:inp1, L:inp2, SS:inp3}, `ROP = ${rop.toFixed(0)} units`);
        result += `<br><a href="https://www.amazon.com/s?k=Inventory+Management" target="_blank" class="amazon-link">üõí Inventory Tools</a>`;
    }
    else if(calcId === 'safety_stock') {
        const SS = inp1 * inp2 * Math.sqrt(inp3);
        result = `<strong>Safety Stock:</strong> ${SS.toFixed(0)} units<br><strong>Service Level:</strong> ${inp1 === 1.65 ? '95%' : inp1 === 1.96 ? '97.5%' : inp1 === 2.33 ? '99%' : 'Custom'}`;
        saveToHistory('Safety Stock', {Z:inp1, sigma:inp2, L:inp3}, `SS = ${SS.toFixed(0)} units`);
        result += `<br><a href="https://www.amazon.com/s?k=Inventory+Software" target="_blank" class="amazon-link">üõí Inventory Software</a>`;
    }
    else if(calcId === 'abc_analysis') {
        const percentage = (inp1 / inp2) * 100;
        const category = percentage >= 70 ? 'A - High Value' : percentage >= 20 ? 'B - Medium Value' : 'C - Low Value';
        result = `<strong>Item Percentage:</strong> ${percentage.toFixed(1)}%<br><strong>ABC Category:</strong> ${category}`;
        saveToHistory('ABC Analysis', {value:inp1, total:inp2}, `${percentage.toFixed(1)}% - ${category}`);
        result += `<br><a href="https://www.amazon.com/s?k=ABC+Analysis+Software" target="_blank" class="amazon-link">üõí Analysis Software</a>`;
    }
    else if(calcId === 'line_balancing') {
        const E = (inp1 / (inp2 * inp3)) * 100;
        const idle = inp2 * inp3 - inp1;
        result = `<strong>Line Efficiency:</strong> ${E.toFixed(2)}%<br><strong>Idle Time:</strong> ${idle.toFixed(1)} min<br><strong>Performance:</strong> ${E >= 85 ? 'Excellent' : E >= 75 ? 'Good' : 'Needs Improvement'}`;
        saveToHistory('Line Balancing', {t:inp1, n:inp2, C:inp3}, `E = ${E.toFixed(2)}%`);
        result += `<br><a href="https://www.amazon.com/s?k=Assembly+Line+Equipment" target="_blank" class="amazon-link">üõí Assembly Equipment</a>`;
    }
    else if(calcId === 'takt_time') {
        const takt = inp1 / inp2;
        result = `<strong>Takt Time:</strong> ${takt.toFixed(1)} seconds/unit<br><strong>Production Rate:</strong> ${(3600/takt).toFixed(1)} units/hour`;
        saveToHistory('Takt Time', {time:inp1, demand:inp2}, `Takt = ${takt.toFixed(1)} s`);
        result += `<br><a href="https://www.amazon.com/s?k=Production+Timer" target="_blank" class="amazon-link">üõí Production Tools</a>`;
    }
    else if(calcId === 'oee') {
        const oee = (inp1/100) * (inp2/100) * (inp3/100) * 100;
        result = `<strong>OEE:</strong> ${oee.toFixed(2)}%<br><strong>World Class:</strong> ${oee >= 85 ? 'YES ‚úì' : 'NO (Target: 85%)'}`;
        saveToHistory('OEE', {A:inp1, P:inp2, Q:inp3}, `OEE = ${oee.toFixed(2)}%`);
        result += `<br><a href="https://www.amazon.com/s?k=OEE+Software" target="_blank" class="amazon-link">üõí OEE Monitoring</a>`;
    }
    else if(calcId === 'learning_curve') {
        const b = Math.log(inp3/100) / Math.log(2);
        const Tn = inp1 * Math.pow(inp2, b);
        result = `<strong>Time for Unit ${inp2}:</strong> ${Tn.toFixed(2)} hrs<br><strong>Learning Rate:</strong> ${inp3}%<br><strong>Total Time (cumulative):</strong> ${(Tn * inp2 / 2).toFixed(1)} hrs (approx)`;
        saveToHistory('Learning Curve', {T1:inp1, n:inp2, rate:inp3}, `T${inp2} = ${Tn.toFixed(2)} hrs`);
        result += `<br><a href="https://www.amazon.com/s?k=Time+Study+Equipment" target="_blank" class="amazon-link">üõí Time Study Tools</a>`;
    }
    else if(calcId === 'breakeven') {
        const bep = inp1 / (inp2 - inp3);
        const revenue = bep * inp2;
        result = `<strong>Break-Even Point:</strong> ${bep.toFixed(0)} units<br><strong>Break-Even Revenue:</strong> $${revenue.toFixed(0)}`;
        saveToHistory('Break-Even Analysis', {FC:inp1, P:inp2, VC:inp3}, `BEP = ${bep.toFixed(0)} units`);
        result += `<br><a href="https://www.amazon.com/s?k=Business+Calculator" target="_blank" class="amazon-link">üõí Business Calculators</a>`;
    }
    else if(calcId === 'productivity') {
        const PI = inp1 / inp2;
        result = `<strong>Productivity Index:</strong> ${PI.toFixed(2)} units/hour<br><strong>Output Rate:</strong> ${inp1} units in ${inp2} hours`;
        saveToHistory('Productivity Index', {output:inp1, input:inp2}, `PI = ${PI.toFixed(2)}`);
        result += `<br><a href="https://www.amazon.com/s?k=Productivity+Software" target="_blank" class="amazon-link">üõí Productivity Tools</a>`;
    }
    else if(calcId === 'cpk') {
        const cpu = (inp1 - inp3) / (3 * inp4);
        const cpl = (inp3 - inp2) / (3 * inp4);
        const cpk = Math.min(cpu, cpl);
        result = `<strong>Cpk:</strong> ${cpk.toFixed(3)}<br><strong>Process Capability:</strong> ${cpk >= 1.33 ? 'Capable' : cpk >= 1.0 ? 'Marginally Capable' : 'Not Capable'}`;
        saveToHistory('Process Capability Cpk', {USL:inp1, LSL:inp2, mu:inp3, sigma:inp4}, `Cpk = ${cpk.toFixed(3)}`);
        result += `<br><a href="https://www.amazon.com/s?k=SPC+Software" target="_blank" class="amazon-link">üõí SPC Software</a>`;
    }
    else if(calcId === 'six_sigma') {
        const DPMO = (inp1 / inp2) * 1000000;
        const sigma = DPMO < 3.4 ? '6œÉ' : DPMO < 233 ? '5œÉ' : DPMO < 6210 ? '4œÉ' : DPMO < 66807 ? '3œÉ' : '<3œÉ';
        result = `<strong>DPMO:</strong> ${DPMO.toFixed(0)}<br><strong>Sigma Level:</strong> ${sigma}<br><strong>Quality:</strong> ${DPMO < 1000 ? 'World Class' : DPMO < 10000 ? 'Excellent' : 'Needs Improvement'}`;
        saveToHistory('Six Sigma DPMO', {defects:inp1, opportunities:inp2}, `DPMO = ${DPMO.toFixed(0)}`);
        result += `<br><a href="https://www.amazon.com/s?k=Six+Sigma+Training" target="_blank" class="amazon-link">üõí Six Sigma Resources</a>`;
    }
    else if(calcId === 'mtbf') {
        const mtbf = inp1 / inp2;
        result = `<strong>MTBF:</strong> ${mtbf.toFixed(1)} hours<br><strong>Failure Rate:</strong> ${(1/mtbf*1000).toFixed(3)} per 1000 hrs`;
        saveToHistory('MTBF', {time:inp1, failures:inp2}, `MTBF = ${mtbf.toFixed(1)} hrs`);
        result += `<br><a href="https://www.amazon.com/s?k=Reliability+Software" target="_blank" class="amazon-link">üõí Reliability Software</a>`;
    }
    else if(calcId === 'mttr') {
        const MTTR = inp1 / inp2;
        result = `<strong>MTTR:</strong> ${MTTR.toFixed(2)} hours<br><strong>Repair Rate:</strong> ${(1/MTTR).toFixed(3)} repairs/hour`;
        saveToHistory('MTTR', {time:inp1, repairs:inp2}, `MTTR = ${MTTR.toFixed(2)} hrs`);
        result += `<br><a href="https://www.amazon.com/s?k=Maintenance+Management+Software" target="_blank" class="amazon-link">üõí Maintenance Tools</a>`;
    }
    else if(calcId === 'availability') {
        const A = (inp1 / (inp1 + inp2)) * 100;
        result = `<strong>System Availability:</strong> ${A.toFixed(2)}%<br><strong>Downtime:</strong> ${((100-A)*24*365/100).toFixed(0)} hours/year<br><strong>Performance:</strong> ${A >= 99 ? 'Excellent' : A >= 95 ? 'Good' : 'Needs Improvement'}`;
        saveToHistory('System Availability', {MTBF:inp1, MTTR:inp2}, `A = ${A.toFixed(2)}%`);
        result += `<br><a href="https://www.amazon.com/s?k=CMMS+Software" target="_blank" class="amazon-link">üõí Asset Management Software</a>`;
    }
    else {
        result = '<strong>Calculator not implemented yet.</strong>';
    }
    
    document.getElementById(`result_${calcId}`).innerHTML = result;
    document.getElementById(`result_${calcId}`).style.display = 'block';
}

// PART 7: Export Functions
function exportCalcPDF(title, resultId) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.setFontSize(20);
    doc.setTextColor(0, 209, 178);
    doc.text('ChemEFlow Calculation Report', 20, 20);
    doc.setFontSize(16);
    doc.setTextColor(0, 0, 0);
    doc.text(title, 20, 35);
    doc.setFontSize(12);
    const resultElement = document.getElementById(resultId);
    const resultText = resultElement ? resultElement.innerText.split('üõí')[0] : 'No results';
    const lines = doc.splitTextToSize(resultText, 170);
    doc.text(lines, 20, 50);
    doc.setFontSize(10);
    doc.setTextColor(100);
    doc.text(`Generated: ${new Date().toLocaleString()}`, 20, 280);
    doc.save(`${title.replace(/ /g, '_')}.pdf`);
    showToast('PDF exported successfully!');
}

function exportCalcExcel(title) {
    const data = [[title, 'ChemEFlow Report'], ['Generated', new Date().toLocaleString()]];
    const ws = XLSX.utils.aoa_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Report');
    XLSX.writeFile(wb, `${title.replace(/ /g, '_')}.xlsx`);
    showToast('Excel exported successfully!');
}

function shareCalc(title) {
    const url = `${window.location.href.split('?')[0]}?calc=${encodeURIComponent(title)}&t=${Date.now()}`;
    document.getElementById('shareLink').value = url;
    openModal('shareModal');
}

function copyShareLink() {
    const link = document.getElementById('shareLink');
    link.select();
    document.execCommand('copy');
    showToast('Link copied to clipboard!');
}

// Keyboard Shortcuts
document.addEventListener('keydown', (e) => {
    if((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        document.getElementById('searchInput').focus();
    }
});

// Initialize on Load
window.addEventListener('load', () => {
    const savedTheme = storage.load('theme');
    if(savedTheme && savedTheme !== 'default') changeTheme(savedTheme);
    console.log('%cChemEFlow v6.0 PRO Loaded ‚úì', 'color: #00d1b2; font-size: 20px; font-weight: bold;');
    console.log('%c90+ Calculators Active Across All Engineering Disciplines!', 'color: #3b82f6; font-size: 14px;');
});

// THEME TOGGLE FUNCTION
function toggleTheme(mode) {
    const body = document.body;
    const lightBtn = document.getElementById('lightBtn');
    const darkBtn = document.getElementById('darkBtn');
    
    if(mode === 'dark') {
        body.classList.add('dark-theme');
        darkBtn.classList.add('active');
        lightBtn.classList.remove('active');
        localStorage.setItem('themeMode', 'dark');
    } else {
        body.classList.remove('dark-theme');
        lightBtn.classList.add('active');
        darkBtn.classList.remove('active');
        localStorage.setItem('themeMode', 'light');
    }
}

// Load saved theme
const savedTheme = localStorage.getItem('themeMode') || 'dark';
toggleTheme(savedTheme);


// PWA INSTALLATION PROMPT
let deferredPrompt;
const installBtn = document.createElement('button');
installBtn.innerHTML = 'üì± Install App';
installBtn.style.cssText = `
    position: fixed;
    bottom: 90px;
    right: 20px;
    padding: 12px 24px;
    background: linear-gradient(135deg, #00f0ff 0%, #0080ff 100%);
    color: #0a0e1a;
    border: none;
    border-radius: 50px;
    font-weight: 800;
    cursor: pointer;
    display: none;
    z-index: 9999;
    box-shadow: 0 4px 20px rgba(0, 240, 255, 0.4);
    animation: pulse-install 2s infinite;
`;

document.body.appendChild(installBtn);

window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installBtn.style.display = 'block';
});

installBtn.addEventListener('click', async () => {
    if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
            console.log('PWA installed');
            installBtn.style.display = 'none';
        }
        deferredPrompt = null;
    }
});

// Register Service Worker
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
            .then(reg => console.log('Service Worker registered'))
            .catch(err => console.log('Service Worker registration failed'));
    });
}

// GOOGLE ADMOB INTEGRATION (Add your Ad Unit IDs)
// Step 1: Sign up at https://admob.google.com
// Step 2: Create ad units and get IDs
// Step 3: Replace 'YOUR_AD_UNIT_ID' below with your actual IDs

/*
// BANNER AD EXAMPLE (Uncomment after getting Ad Unit ID)
function loadBannerAd() {
    const adScript = document.createElement('script');
    adScript.src = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js';
    adScript.setAttribute('data-ad-client', 'ca-pub-YOUR_PUBLISHER_ID');
    adScript.async = true;
    document.head.appendChild(adScript);
    
    // Insert ad after each calculator result
    const adHTML = `
        <ins class="adsbygoogle ad-banner"
             data-ad-client="ca-pub-YOUR_PUBLISHER_ID"
             data-ad-slot="YOUR_AD_SLOT_ID"
             data-ad-format="auto"></ins>
    `;
    
    // Show ad after calculation
    document.querySelectorAll('.result-box').forEach(result => {
        if (result.style.display !== 'none') {
            const adContainer = document.createElement('div');
            adContainer.innerHTML = adHTML;
            result.parentNode.insertBefore(adContainer, result.nextSibling);
            (adsbygoogle = window.adsbygoogle || []).push({});
        }
    });
}

// INTERSTITIAL AD (Full screen ad every 3 calculations)
let calculationCount = 0;
function showInterstitialAd() {
    calculationCount++;
    if (calculationCount % 3 === 0) {
        // Show interstitial ad
        // AdMob will handle this automatically when integrated
        console.log('Interstitial ad would show here');
    }
}

// Call this in your calculate() function
// Add: showInterstitialAd(); after line that shows results
*/

// MONETIZATION TRACKING
let userClicks = 0;
let adImpressions = 0;
let amazonClicks = 0;

document.addEventListener('click', (e) => {
    userClicks++;
    
    // Track Amazon affiliate clicks
    if (e.target.classList.contains('amazon-link')) {
        amazonClicks++;
        console.log('Amazon click:', amazonClicks);
        // Send to analytics
    }
    
    // Track ad clicks (AdMob handles payment automatically)
    if (e.target.classList.contains('adsbygoogle')) {
        adImpressions++;
        console.log('Ad click! You earn money from this.');
    }
});

// ANALYTICS DASHBOARD (shows your earnings potential)
function showMonetizationStats() {
    console.log('=== MONETIZATION STATS ===');
    console.log('Total user interactions:', userClicks);
    console.log('Amazon clicks:', amazonClicks, '(~4% commission on sales)');
    console.log('Ad impressions:', adImpressions, '(~$0.50-$5 per 1000 views)');
    console.log('========================');
}

// Show stats every 5 minutes
setInterval(showMonetizationStats, 300000);

console.log('%cüí∞ MONETIZATION READY!', 'color: #00ff00; font-size: 16px; font-weight: bold;');
console.log('%cTo activate ads:', 'font-size: 14px;');
console.log('1. Sign up: https://admob.google.com');
console.log('2. Add your Publisher ID to the code above');
console.log('3. Uncomment the ad functions');
console.log('4. Deploy to a web server');
console.log('%cAmazon affiliate links are already active!', 'color: #ff9900; font-weight: bold;');

</script>

</body>
</html>